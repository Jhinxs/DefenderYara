
rule TrojanDownloader_BAT_Agent_MC_MTB{
	meta:
		description = "TrojanDownloader:BAT/Agent.MC!MTB,SIGNATURE_TYPE_PEHSTR_EXT,0d 00 0d 00 0e 00 00 "
		
	strings :
		$a_02_0 = {68 00 74 00 74 00 70 00 73 00 3a 00 2f 00 2f 00 63 00 64 00 6e 00 2e 00 64 00 69 00 73 00 63 00 6f 00 72 00 64 00 61 00 70 00 70 00 2e 00 63 00 6f 00 6d 00 2f 00 61 00 74 00 74 00 61 00 63 00 68 00 6d 00 65 00 6e 00 74 00 73 00 2f 00 [0-60] 2f 00 46 00 69 00 6c 00 65 00 2e 00 70 00 6e 00 67 00 } //1
		$a_02_1 = {68 74 74 70 73 3a 2f 2f 63 64 6e 2e 64 69 73 63 6f 72 64 61 70 70 2e 63 6f 6d 2f 61 74 74 61 63 68 6d 65 6e 74 73 2f [0-60] 2f 46 69 6c 65 2e 70 6e 67 } //1
		$a_03_2 = {16 2c 46 26 28 ?? ?? ?? 0a 06 6f ?? ?? ?? 0a 72 ae 00 00 70 14 6f ?? ?? ?? 0a 17 2d 2f 26 d0 ?? 00 00 01 28 ?? ?? ?? 0a 72 ?? ?? ?? 70 28 ?? ?? ?? 0a 14 17 8d ?? 00 00 01 25 16 07 a2 6f ?? ?? ?? 0a 74 ?? 00 00 1b 2b 06 0a 2b b8 0b 2b cf 2a } //1
		$a_81_3 = {53 68 6f 77 57 69 6e 64 6f 77 } //1 ShowWindow
		$a_81_4 = {52 65 70 6c 61 63 65 } //1 Replace
		$a_81_5 = {44 6f 77 6e 6c 6f 61 64 44 61 74 61 } //1 DownloadData
		$a_81_6 = {47 65 74 53 74 72 69 6e 67 } //1 GetString
		$a_81_7 = {49 6e 76 6f 6b 65 } //1 Invoke
		$a_81_8 = {46 72 6f 6d 42 61 73 65 36 34 } //1 FromBase64
		$a_81_9 = {47 65 74 54 79 70 65 73 } //1 GetTypes
		$a_81_10 = {44 65 62 75 67 } //1 Debug
		$a_81_11 = {70 6f 77 65 72 73 68 65 6c 6c } //1 powershell
		$a_81_12 = {54 65 73 74 2d 4e 65 74 43 6f 6e 6e 65 63 74 69 6f 6e 20 2d 54 72 61 63 65 52 6f 75 74 65 } //1 Test-NetConnection -TraceRoute
		$a_81_13 = {57 72 69 74 65 4c 69 6e 65 } //1 WriteLine
	condition:
		((#a_02_0  & 1)*1+(#a_02_1  & 1)*1+(#a_03_2  & 1)*1+(#a_81_3  & 1)*1+(#a_81_4  & 1)*1+(#a_81_5  & 1)*1+(#a_81_6  & 1)*1+(#a_81_7  & 1)*1+(#a_81_8  & 1)*1+(#a_81_9  & 1)*1+(#a_81_10  & 1)*1+(#a_81_11  & 1)*1+(#a_81_12  & 1)*1+(#a_81_13  & 1)*1) >=13
 
}