
rule TrojanDownloader_O97M_Donoff_AC{
	meta:
		description = "TrojanDownloader:O97M/Donoff.AC,SIGNATURE_TYPE_MACROHSTR_EXT,04 00 04 00 05 00 00 "
		
	strings :
		$a_00_0 = {41 72 72 61 79 28 53 74 72 52 65 76 65 72 73 65 28 22 41 70 70 44 61 74 61 22 29 2c 20 53 74 72 52 65 76 65 72 73 65 28 22 54 45 4d 50 22 29 29 } //1 Array(StrReverse("AppData"), StrReverse("TEMP"))
		$a_00_1 = {45 6e 76 69 72 6f 6e 28 6e 29 20 26 20 53 74 72 52 65 76 65 72 73 65 28 22 5c 22 29 } //1 Environ(n) & StrReverse("\")
		$a_01_2 = {4c 6d 56 34 5a 51 3d 3d 22 29 } //1 LmV4ZQ==")
		$a_01_3 = {28 22 61 48 52 30 63 44 6f 76 } //1 ("aHR0cDov
		$a_01_4 = {26 20 4d 69 64 24 28 57 2c 20 49 6e 74 28 52 6e 64 28 29 20 2a 20 4c 65 6e 28 57 29 20 2b 20 31 29 2c 20 31 29 } //1 & Mid$(W, Int(Rnd() * Len(W) + 1), 1)
	condition:
		((#a_00_0  & 1)*1+(#a_00_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1) >=4
 
}
rule TrojanDownloader_O97M_Donoff_AC_2{
	meta:
		description = "TrojanDownloader:O97M/Donoff.AC,SIGNATURE_TYPE_MACROHSTR_EXT,03 00 03 00 03 00 00 "
		
	strings :
		$a_03_0 = {45 6e 76 69 72 6f 6e 28 4d 6f 64 75 6c 65 33 2e [0-10] 29 20 26 20 53 74 72 52 65 76 65 72 73 65 28 43 68 72 24 28 31 30 31 29 20 26 20 43 68 72 24 28 34 36 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 31 31 32 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 31 31 32 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 34 37 29 29 } //1
		$a_01_1 = {53 74 72 52 65 76 65 72 73 65 28 43 68 72 24 28 31 30 31 29 20 26 20 43 68 72 24 28 31 32 30 29 29 } //1 StrReverse(Chr$(101) & Chr$(120))
		$a_01_2 = {53 68 65 6c 6c 28 53 74 72 52 65 76 65 72 73 65 28 43 68 72 24 28 31 30 31 29 20 26 20 43 68 72 24 28 34 36 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 31 31 32 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 31 31 32 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 34 37 29 20 26 20 43 68 72 24 28 33 37 29 20 26 20 43 68 72 24 28 38 30 29 20 26 20 43 68 72 24 28 37 37 29 20 26 20 43 68 72 24 28 38 34 29 20 26 20 43 68 72 24 28 33 37 29 20 26 20 43 68 72 24 28 33 32 29 20 26 20 43 68 72 24 28 31 31 36 29 20 26 20 43 68 72 24 28 31 31 34 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 31 31 36 29 } //1 Shell(StrReverse(Chr$(101) & Chr$(46) & Chr$(97) & Chr$(112) & Chr$(97) & Chr$(112) & Chr$(97) & Chr$(47) & Chr$(37) & Chr$(80) & Chr$(77) & Chr$(84) & Chr$(37) & Chr$(32) & Chr$(116) & Chr$(114) & Chr$(97) & Chr$(116)
	condition:
		((#a_03_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1) >=3
 
}
rule TrojanDownloader_O97M_Donoff_AC_3{
	meta:
		description = "TrojanDownloader:O97M/Donoff.AC,SIGNATURE_TYPE_MACROHSTR_EXT,02 00 02 00 02 00 00 "
		
	strings :
		$a_01_0 = {53 68 65 6c 6c 28 43 68 72 24 28 39 39 29 20 26 20 43 68 72 24 28 31 30 39 29 20 26 20 43 68 72 24 28 31 30 30 29 20 26 20 43 68 72 24 28 33 32 29 20 26 20 43 68 72 24 28 34 37 29 20 26 20 43 68 72 24 28 39 39 29 20 26 20 43 68 72 24 28 33 32 29 20 26 20 43 68 72 24 28 31 31 35 29 20 26 20 43 68 72 24 28 31 31 36 29 20 26 20 43 68 72 24 28 39 37 29 20 26 20 43 68 72 24 28 31 31 34 29 20 26 20 43 68 72 24 28 31 31 36 29 20 26 20 43 68 72 24 28 33 32 29 20 26 20 43 68 72 24 28 33 37 29 20 26 20 43 68 72 24 28 38 34 29 20 26 20 43 68 72 24 28 37 37 29 20 26 20 43 68 72 24 28 38 30 29 20 26 20 43 68 72 24 28 33 37 29 20 26 20 43 68 72 24 28 34 37 29 20 26 20 43 68 72 24 28 38 30 29 } //1 Shell(Chr$(99) & Chr$(109) & Chr$(100) & Chr$(32) & Chr$(47) & Chr$(99) & Chr$(32) & Chr$(115) & Chr$(116) & Chr$(97) & Chr$(114) & Chr$(116) & Chr$(32) & Chr$(37) & Chr$(84) & Chr$(77) & Chr$(80) & Chr$(37) & Chr$(47) & Chr$(80)
		$a_01_1 = {45 6e 76 69 72 6f 6e 28 4d 6f 64 75 6c 65 33 2e 47 46 48 46 44 56 43 58 56 5a 58 43 29 20 26 20 43 68 72 24 28 34 37 29 20 26 20 43 68 72 24 28 38 30 29 20 26 20 43 68 72 24 28 37 33 29 20 26 20 43 68 72 24 28 36 38 29 20 26 20 43 68 72 24 28 36 35 29 20 26 20 43 68 72 24 28 38 32 29 20 26 20 43 68 72 24 28 36 35 29 20 26 20 43 68 72 24 28 38 33 29 20 26 20 43 68 72 24 28 34 36 29 20 26 20 43 68 72 24 28 31 30 31 29 20 2b 20 68 67 4a 4b 53 44 56 46 4b 66 6a 20 2b 20 43 68 72 24 28 31 30 31 29 } //1 Environ(Module3.GFHFDVCXVZXC) & Chr$(47) & Chr$(80) & Chr$(73) & Chr$(68) & Chr$(65) & Chr$(82) & Chr$(65) & Chr$(83) & Chr$(46) & Chr$(101) + hgJKSDVFKfj + Chr$(101)
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1) >=2
 
}