
rule TrojanDownloader_O97M_Donoff_EO{
	meta:
		description = "TrojanDownloader:O97M/Donoff.EO,SIGNATURE_TYPE_MACROHSTR_EXT,03 00 03 00 11 00 00 "
		
	strings :
		$a_00_0 = {61 72 72 61 79 28 22 63 6d 64 22 } //1 array("cmd"
		$a_02_1 = {61 72 72 61 79 28 2d ?? 2c 20 22 63 6d 64 22 } //1
		$a_02_2 = {61 72 72 61 79 28 2d ?? 2c 20 2d ?? 2c 20 22 63 6d 64 22 } //1
		$a_02_3 = {61 72 72 61 79 28 2d ?? 2c 20 2d ?? 2c 20 2d ?? 2c 20 22 63 6d 64 22 } //1
		$a_02_4 = {61 72 72 61 79 28 2d ?? 2c 20 2d ?? 2c 20 2d ?? 2c 20 2d ?? 2c 20 22 63 6d 64 22 } //1
		$a_00_5 = {4e 61 4e 2c 20 22 63 6d 64 22 } //1 NaN, "cmd"
		$a_00_6 = {61 72 72 61 79 28 22 2e 65 78 22 } //1 array(".ex"
		$a_02_7 = {61 72 72 61 79 28 2d ?? 2c 20 22 2e 65 78 22 } //1
		$a_02_8 = {61 72 72 61 79 28 2d ?? 2c 20 2d ?? 2c 20 22 2e 65 78 22 } //1
		$a_02_9 = {61 72 72 61 79 28 2d ?? 2c 20 2d ?? 2c 20 2d ?? 2c 20 22 2e 65 78 22 } //1
		$a_02_10 = {61 72 72 61 79 28 2d ?? 2c 20 2d ?? 2c 20 2d ?? 2c 20 2d ?? 2c 20 22 2e 65 78 22 } //1
		$a_00_11 = {4e 61 4e 2c 20 22 2e 65 78 22 } //1 NaN, ".ex"
		$a_03_12 = {49 66 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 53 63 72 69 70 74 73 2e 43 6f 75 6e 74 20 3d 20 30 20 54 68 65 6e 0d 0a ?? ?? ?? ?? [0-0a] 20 3d 20 ?? ?? ?? [0-05] 20 26 20 ?? ?? ?? [0-05] 20 26 20 ?? ?? ?? [0-05] 20 26 } //1
		$a_01_13 = {49 66 20 56 61 72 54 79 70 65 28 41 63 74 69 76 65 57 6f 72 6b 62 6f 6f 6b 2e 4e 61 6d 65 29 } //1 If VarType(ActiveWorkbook.Name)
		$a_01_14 = {49 66 20 41 63 74 69 76 65 44 6f 63 75 6d 65 6e 74 2e 54 61 62 6c 65 73 2e 43 6f 75 6e 74 20 3d 20 30 20 54 68 65 6e } //1 If ActiveDocument.Tables.Count = 0 Then
		$a_01_15 = {49 66 20 41 70 70 6c 69 63 61 74 69 6f 6e 2e 42 75 69 6c 64 20 3e 20 31 30 30 20 54 68 65 6e } //1 If Application.Build > 100 Then
		$a_01_16 = {49 66 20 41 70 70 6c 69 63 61 74 69 6f 6e 2e 41 63 74 69 76 65 45 6e 63 72 79 70 74 69 6f 6e 53 65 73 73 69 6f 6e 20 54 68 65 6e } //1 If Application.ActiveEncryptionSession Then
	condition:
		((#a_00_0  & 1)*1+(#a_02_1  & 1)*1+(#a_02_2  & 1)*1+(#a_02_3  & 1)*1+(#a_02_4  & 1)*1+(#a_00_5  & 1)*1+(#a_00_6  & 1)*1+(#a_02_7  & 1)*1+(#a_02_8  & 1)*1+(#a_02_9  & 1)*1+(#a_02_10  & 1)*1+(#a_00_11  & 1)*1+(#a_03_12  & 1)*1+(#a_01_13  & 1)*1+(#a_01_14  & 1)*1+(#a_01_15  & 1)*1+(#a_01_16  & 1)*1) >=3
 
}