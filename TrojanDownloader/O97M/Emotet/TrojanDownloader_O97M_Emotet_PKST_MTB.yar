
rule TrojanDownloader_O97M_Emotet_PKST_MTB{
	meta:
		description = "TrojanDownloader:O97M/Emotet.PKST!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,04 00 04 00 09 00 00 "
		
	strings :
		$a_01_0 = {72 65 67 73 76 72 33 32 2e 65 78 65 } //1 regsvr32.exe
		$a_01_1 = {53 79 73 57 6f 77 36 34 5c } //1 SysWow64\
		$a_01_2 = {5c 57 69 6e 64 6f 77 73 5c } //1 \Windows\
		$a_01_3 = {2e 63 22 26 22 6c 69 6e 22 26 22 74 6d 22 26 22 6f 72 65 22 26 22 79 2e 63 22 26 22 6f 6d 2f 77 22 26 22 70 2d 63 22 26 22 6f 6e 22 26 22 74 65 22 26 22 6e 74 2f 51 53 22 26 22 7a 62 22 26 22 48 38 49 22 26 22 6b 6c 22 26 22 38 45 2f 22 2c 22 } //1 .c"&"lin"&"tm"&"ore"&"y.c"&"om/w"&"p-c"&"on"&"te"&"nt/QS"&"zb"&"H8I"&"kl"&"8E/","
		$a_01_4 = {63 69 62 22 26 22 65 72 66 61 22 26 22 6c 6c 61 22 26 22 73 2e 63 6f 22 26 22 6d 2f 77 22 26 22 70 2d 61 22 26 22 64 6d 22 26 22 69 6e 2f 34 22 26 22 73 55 31 22 26 22 64 41 22 26 22 54 79 2f 22 2c 22 } //1 cib"&"erfa"&"lla"&"s.co"&"m/w"&"p-a"&"dm"&"in/4"&"sU1"&"dA"&"Ty/","
		$a_01_5 = {63 6f 22 26 22 64 22 26 22 65 37 38 22 26 22 36 2e 63 22 26 22 6f 22 26 22 6d 2f 62 22 26 22 65 65 6c 22 26 22 64 4f 22 26 22 4c 22 26 22 44 2f 41 54 22 26 22 6e 4e 6b 22 26 22 33 31 22 26 22 36 2f 22 2c 22 } //1 co"&"d"&"e78"&"6.c"&"o"&"m/b"&"eel"&"dO"&"L"&"D/AT"&"nNk"&"31"&"6/","
		$a_01_6 = {63 6f 22 26 22 6d 62 61 22 26 22 74 65 6e 74 65 22 26 22 72 70 72 69 22 26 22 73 65 22 26 22 73 2e 63 22 26 22 6f 6d 2f 63 22 26 22 67 69 2d 62 22 26 22 69 6e 2f 31 42 22 26 22 61 62 6d 22 26 22 4e 71 43 4b 22 26 22 42 78 22 26 22 55 49 7a 22 26 22 55 79 2f 22 2c 22 } //1 co"&"mba"&"tente"&"rpri"&"se"&"s.c"&"om/c"&"gi-b"&"in/1B"&"abm"&"NqCK"&"Bx"&"UIz"&"Uy/","
		$a_01_7 = {73 22 26 22 64 2d 31 36 22 26 22 38 22 26 22 34 36 32 22 26 22 35 2d 68 22 26 22 30 30 22 26 22 30 30 22 26 22 31 2e 66 65 22 26 22 72 6f 22 26 22 7a 6f 2e 6e 22 26 22 65 74 2f 50 61 67 22 26 22 69 6e 61 22 26 22 4d 22 26 22 61 73 56 69 65 22 26 22 6a 61 31 33 22 26 22 32 31 36 22 26 22 35 34 2f 46 22 26 22 31 4d 35 22 26 22 64 42 22 26 22 75 38 61 22 26 22 78 75 22 26 22 51 6b 78 22 26 22 30 70 22 26 22 38 2f 22 2c 22 } //1 s"&"d-16"&"8"&"462"&"5-h"&"00"&"00"&"1.fe"&"ro"&"zo.n"&"et/Pag"&"ina"&"M"&"asVie"&"ja13"&"216"&"54/F"&"1M5"&"dB"&"u8a"&"xu"&"Qkx"&"0p"&"8/","
		$a_01_8 = {63 22 26 22 6f 6d 22 26 22 61 72 63 61 22 26 22 68 6f 22 26 22 79 2e 63 22 26 22 6f 6d 2e 61 22 26 22 72 2f 77 22 26 22 70 2d 63 6f 22 26 22 6e 74 22 26 22 65 6e 22 26 22 74 2f 53 22 26 22 31 6e 6b 72 22 26 22 78 43 22 26 22 63 44 22 26 22 56 38 22 26 22 39 44 22 26 22 4c 70 22 26 22 54 58 22 26 22 68 71 22 26 22 43 2f 22 2c 22 } //1 c"&"om"&"arca"&"ho"&"y.c"&"om.a"&"r/w"&"p-co"&"nt"&"en"&"t/S"&"1nkr"&"xC"&"cD"&"V8"&"9D"&"Lp"&"TX"&"hq"&"C/","
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1) >=4
 
}