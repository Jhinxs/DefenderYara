
rule TrojanProxy_Win32_Ranky{
	meta:
		description = "TrojanProxy:Win32/Ranky,SIGNATURE_TYPE_PEHSTR_EXT,0a 00 07 00 1f 00 00 "
		
	strings :
		$a_00_0 = {99 b9 fd fb 00 00 f7 f9 81 c2 01 04 00 00 } //4
		$a_00_1 = {99 b9 40 9c 00 00 f7 f9 81 c2 10 27 00 00 } //4
		$a_00_2 = {0f b7 c0 bf fe fb 00 00 be 00 04 00 00 99 8b cf f7 f9 03 d6 } //4
		$a_00_3 = {99 b9 40 9c 00 00 8b 1d ?? ?? 40 00 f7 f9 66 c7 44 24 ?? 02 00 81 c2 10 27 00 00 52 } //4
		$a_02_4 = {ff fe ff 83 f8 68 75 ?? 0f b6 8d df ff fe ff 83 f9 70 75 } //3
		$a_00_5 = {80 bd 88 f2 ff ff 05 75 2f c6 85 88 f2 ff ff 05 88 9d 89 f2 ff ff } //3
		$a_00_6 = {80 bd 88 f2 ff ff 04 0f 85 da 03 00 00 8a 85 8a f2 ff ff } //3
		$a_00_7 = {73 68 65 64 0d 0a 50 72 6f 78 79 2d 61 67 65 6e } //2
		$a_02_8 = {00 00 68 b8 0b 00 00 8d 85 8c ?? ff ff 50 } //2
		$a_00_9 = {80 bd 8c f2 ff ff 47 74 0d 80 bd 8c f2 ff ff 50 } //2
		$a_00_10 = {8b 85 80 f1 ff ff 25 ff 00 00 00 83 f8 47 74 15 } //2
		$a_02_11 = {eb 13 68 20 4e 00 00 ff 76 08 e8 ?? ?? 00 00 85 c0 7d 08 6a 05 } //2
		$a_00_12 = {0f b6 8d d8 ff fe ff 83 f9 47 0f 85 } //2
		$a_00_13 = {80 bd 88 f2 ff ff 47 74 0d 80 bd 88 f2 ff ff 50 } //2
		$a_02_14 = {8d 7e 28 66 c7 07 02 00 e8 ?? ?? 00 00 6a 10 57 ff 76 08 66 89 46 2a e8 ?? ?? 00 00 85 c0 } //2
		$a_00_15 = {88 18 59 53 53 53 53 53 53 53 6a ff 6a 04 6a ff 57 ff 15 } //2
		$a_02_16 = {40 00 3d b7 00 00 00 0f 84 ?? ?? 00 00 57 6a 01 } //2
		$a_00_17 = {56 56 56 56 56 56 56 6a ff 6a 02 6a ff 53 ff 15 } //2
		$a_00_18 = {83 bd 6c ff ff ff 05 0f 82 97 00 00 00 83 bd 70 ff ff ff 01 } //2
		$a_02_19 = {2f 61 2e 70 68 70 3f [0-04] 68 74 74 70 3a 2f 2f } //2
		$a_00_20 = {8d 45 fc 50 68 7e 66 04 80 } //1
		$a_00_21 = {83 66 10 00 6a 11 6a 02 6a 02 e8 } //1
		$a_00_22 = {8d 44 24 10 bb 06 00 02 00 50 53 6a 00 bf 02 00 00 80 68 } //1
		$a_00_23 = {48 54 54 50 2f 31 2e 30 20 32 30 30 20 43 6f 6e 6e 65 63 74 69 6f 6e 20 65 73 74 61 62 6c 69 73 68 65 64 } //1 HTTP/1.0 200 Connection established
		$a_00_24 = {72 65 67 69 73 74 65 72 73 65 72 76 69 63 65 70 72 6f 63 65 73 73 } //1 registerserviceprocess
		$a_00_25 = {50 72 6f 78 79 2d 61 67 65 6e 74 3a } //1 Proxy-agent:
		$a_00_26 = {25 64 2e 25 64 2e 25 64 2e 25 64 } //1 %d.%d.%d.%d
		$a_00_27 = {41 75 74 6f 55 70 64 61 74 65 4d 67 72 } //1 AutoUpdateMgr
		$a_00_28 = {2f 61 2e 70 68 70 3f } //1 /a.php?
		$a_00_29 = {2f 62 2e 70 68 70 3f } //1 /b.php?
		$a_00_30 = {25 73 3a 2a 3a 45 6e 61 62 6c 65 64 3a 25 } //1 %s:*:Enabled:%
	condition:
		((#a_00_0  & 1)*4+(#a_00_1  & 1)*4+(#a_00_2  & 1)*4+(#a_00_3  & 1)*4+(#a_02_4  & 1)*3+(#a_00_5  & 1)*3+(#a_00_6  & 1)*3+(#a_00_7  & 1)*2+(#a_02_8  & 1)*2+(#a_00_9  & 1)*2+(#a_00_10  & 1)*2+(#a_02_11  & 1)*2+(#a_00_12  & 1)*2+(#a_00_13  & 1)*2+(#a_02_14  & 1)*2+(#a_00_15  & 1)*2+(#a_02_16  & 1)*2+(#a_00_17  & 1)*2+(#a_00_18  & 1)*2+(#a_02_19  & 1)*2+(#a_00_20  & 1)*1+(#a_00_21  & 1)*1+(#a_00_22  & 1)*1+(#a_00_23  & 1)*1+(#a_00_24  & 1)*1+(#a_00_25  & 1)*1+(#a_00_26  & 1)*1+(#a_00_27  & 1)*1+(#a_00_28  & 1)*1+(#a_00_29  & 1)*1+(#a_00_30  & 1)*1) >=7
 
}