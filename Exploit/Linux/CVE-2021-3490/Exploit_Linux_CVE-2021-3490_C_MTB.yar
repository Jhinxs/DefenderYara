
rule Exploit_Linux_CVE-2021-3490_C_MTB{
	meta:
		description = "Exploit:Linux/CVE-2021-3490.C!MTB,SIGNATURE_TYPE_ELFHSTR_EXT,09 00 09 00 0c 00 00 "
		
	strings :
		$a_00_0 = {66 72 61 6d 65 5f 64 75 6d 6d 79 5f 69 6e 69 74 5f 61 72 72 61 79 5f 65 6e 74 72 79 } //1 frame_dummy_init_array_entry
		$a_00_1 = {6c 65 61 6b 5f 6f 6f 62 5f 6d 61 70 5f 70 74 72 } //1 leak_oob_map_ptr
		$a_00_2 = {6f 76 65 72 77 72 69 74 65 5f 63 72 65 64 } //1 overwrite_cred
		$a_00_3 = {6f 62 6a 5f 67 65 74 5f 69 6e 66 6f 5f 62 79 5f 66 64 } //1 obj_get_info_by_fd
		$a_00_4 = {6b 65 72 6e 65 6c 5f 77 72 69 74 65 5f 75 69 6e 74 } //1 kernel_write_uint
		$a_00_5 = {73 65 61 72 63 68 5f 69 6e 69 74 5f 70 69 64 5f 6e 73 5f 6b 73 74 72 74 61 62 } //1 search_init_pid_ns_kstrtab
		$a_00_6 = {73 65 61 72 63 68 5f 69 6e 69 74 5f 70 69 64 5f 6e 73 5f 6b 73 79 6d 74 61 62 } //1 search_init_pid_ns_ksymtab
		$a_00_7 = {66 61 69 6c 65 64 20 74 6f 20 6c 65 61 6b 20 70 74 72 20 74 6f 20 42 50 46 20 6d 61 70 } //1 failed to leak ptr to BPF map
		$a_00_8 = {70 72 65 70 61 72 69 6e 67 20 74 6f 20 6f 76 65 72 77 72 69 74 65 20 63 72 65 64 73 2e 2e 2e } //1 preparing to overwrite creds...
		$a_00_9 = {73 75 63 63 65 73 73 21 20 65 6e 6a 6f 79 20 72 30 30 74 } //1 success! enjoy r00t
		$a_00_10 = {55 73 65 61 67 65 3a 20 25 73 20 3c 70 61 74 68 20 74 6f 20 70 72 6f 67 72 61 6d 20 74 6f 20 65 78 65 63 75 74 65 20 61 73 20 72 6f 6f 74 3e } //1 Useage: %s <path to program to execute as root>
		$a_00_11 = {73 65 61 72 63 68 69 6e 67 20 66 6f 72 20 69 6e 69 74 5f 70 69 64 5f 6e 73 20 69 6e 20 6b 73 79 6d 74 61 62 } //1 searching for init_pid_ns in ksymtab
	condition:
		((#a_00_0  & 1)*1+(#a_00_1  & 1)*1+(#a_00_2  & 1)*1+(#a_00_3  & 1)*1+(#a_00_4  & 1)*1+(#a_00_5  & 1)*1+(#a_00_6  & 1)*1+(#a_00_7  & 1)*1+(#a_00_8  & 1)*1+(#a_00_9  & 1)*1+(#a_00_10  & 1)*1+(#a_00_11  & 1)*1) >=9
 
}