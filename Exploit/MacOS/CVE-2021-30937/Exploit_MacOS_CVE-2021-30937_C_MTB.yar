
rule Exploit_MacOS_CVE-2021-30937_C_MTB{
	meta:
		description = "Exploit:MacOS/CVE-2021-30937.C!MTB,SIGNATURE_TYPE_MACHOHSTR_EXT,04 00 04 00 04 00 00 "
		
	strings :
		$a_01_0 = {65 78 70 6c 6f 69 74 5f 67 65 74 5f 6b 72 77 5f 61 6e 64 5f 6b 65 72 6e 65 6c 5f 62 61 73 65 } //1 exploit_get_krw_and_kernel_base
		$a_01_1 = {65 78 70 6c 6f 69 74 61 74 69 6f 6e 5f 67 65 74 5f 6b 72 77 5f 77 69 74 68 5f 61 72 62 5f 66 72 65 65 } //1 exploitation_get_krw_with_arb_free
		$a_01_2 = {49 4f 47 50 55 5f 67 65 74 5f 63 6f 6d 6d 61 6e 64 5f 71 75 65 75 65 5f 65 78 74 72 61 5f 72 65 66 69 6c 6c 73 5f 6e 65 65 64 65 64 } //1 IOGPU_get_command_queue_extra_refills_needed
		$a_01_3 = {6b 68 65 61 70 5f 64 65 66 61 75 6c 74 5f 69 64 78 } //1 kheap_default_idx
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1) >=4
 
}