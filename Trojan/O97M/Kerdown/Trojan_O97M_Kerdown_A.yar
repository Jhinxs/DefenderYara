
rule Trojan_O97M_Kerdown_A{
	meta:
		description = "Trojan:O97M/Kerdown.A,SIGNATURE_TYPE_MACROHSTR_EXT,03 00 03 00 03 00 00 "
		
	strings :
		$a_01_0 = {77 73 68 2e 52 75 6e 20 22 63 6d 64 2e 65 78 65 20 2f 53 20 2f 43 20 72 65 67 20 61 64 64 20 20 48 4b 45 59 5f 43 55 52 52 45 4e 54 5f 55 53 45 52 5c 53 6f 66 74 77 61 72 65 5c 43 6c 61 73 73 65 73 5c 43 4c 53 49 44 5c 20 2f 66 20 2f 72 65 67 3a 36 34 22 2c 20 77 69 6e 64 6f 77 53 74 79 6c 65 2c 20 77 61 69 74 4f 6e 52 65 74 75 72 6e } //1 wsh.Run "cmd.exe /S /C reg add  HKEY_CURRENT_USER\Software\Classes\CLSID\ /f /reg:64", windowStyle, waitOnReturn
		$a_01_1 = {77 73 68 2e 52 75 6e 20 22 63 6d 64 2e 65 78 65 20 2f 53 20 2f 43 20 72 65 67 20 61 64 64 20 20 48 4b 45 59 5f 43 55 52 52 45 4e 54 5f 55 53 45 52 5c 53 6f 66 74 77 61 72 65 5c 43 6c 61 73 73 65 73 5c 43 4c 53 49 44 5c 7b 32 44 45 41 36 35 38 46 2d 35 34 43 31 2d 34 32 32 37 2d 41 46 39 42 2d 32 36 30 41 42 35 46 43 33 35 34 33 7d 20 2f 66 20 2f 72 65 67 3a 36 34 22 2c 20 77 69 6e 64 6f 77 53 74 79 6c 65 2c 20 77 61 69 74 4f 6e 52 65 74 75 72 6e } //1 wsh.Run "cmd.exe /S /C reg add  HKEY_CURRENT_USER\Software\Classes\CLSID\{2DEA658F-54C1-4227-AF9B-260AB5FC3543} /f /reg:64", windowStyle, waitOnReturn
		$a_01_2 = {77 73 68 2e 52 75 6e 20 22 63 6d 64 2e 65 78 65 20 2f 53 20 2f 43 20 72 65 67 20 61 64 64 20 20 48 4b 45 59 5f 43 55 52 52 45 4e 54 5f 55 53 45 52 5c 53 6f 66 74 77 61 72 65 5c 43 6c 61 73 73 65 73 5c 43 4c 53 49 44 5c 7b 32 44 45 41 36 35 38 46 2d 35 34 43 31 2d 34 32 32 37 2d 41 46 39 42 2d 32 36 30 41 42 35 46 43 33 35 34 33 7d 5c 49 6e 70 72 6f 63 53 65 72 76 65 72 33 32 20 2f 76 65 20 2f 74 20 52 45 47 5f 53 5a 20 2f 64 } //1 wsh.Run "cmd.exe /S /C reg add  HKEY_CURRENT_USER\Software\Classes\CLSID\{2DEA658F-54C1-4227-AF9B-260AB5FC3543}\InprocServer32 /ve /t REG_SZ /d
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1) >=3
 
}