
rule Trojan_O97M_Obfuse_BD{
	meta:
		description = "Trojan:O97M/Obfuse.BD,SIGNATURE_TYPE_MACROHSTR_EXT,03 00 03 00 09 00 00 "
		
	strings :
		$a_03_0 = {4d 64 2e 22 20 2b [0-30] 2b 20 46 6f 72 6d 61 74 28 43 68 72 [0-01] 28 } //2
		$a_03_1 = {22 4d 64 22 20 2b 20 43 68 72 28 53 71 72 28 [0-20] 29 29 20 2b 20 22 22 20 2b 20 46 6f 72 6d 61 74 28 43 68 72 } //2
		$a_03_2 = {22 64 2e 22 20 2b 20 46 6f 72 6d 61 74 28 43 68 72 28 28 28 [0-20] 29 29 29 20 2b 20 22 [0-01] 22 20 2b 20 46 6f 72 6d 61 74 28 43 68 72 28 28 28 } //2
		$a_01_3 = {62 23 67 23 42 23 30 23 41 23 43 23 6b 23 41 23 4c 23 67 23 42 23 45 23 41 23 47 23 38 23 41 23 64 23 77 23 42 23 75 23 41 23 47 23 77 23 41 23 62 23 77 23 42 23 68 23 41 23 47 23 51 23 41 23 52 23 67 23 42 23 70 23 41 23 47 23 77 23 41 23 5a 23 51 23 41 23 6f 23 41 23 43 23 49 } //1 b#g#B#0#A#C#k#A#L#g#B#E#A#G#8#A#d#w#B#u#A#G#w#A#b#w#B#h#A#G#Q#A#R#g#B#p#A#G#w#A#Z#Q#A#o#A#C#I
		$a_01_4 = {25 62 25 67 25 42 25 30 25 41 25 43 25 6b 25 41 25 4c 25 67 25 42 25 45 25 41 25 47 25 38 25 41 25 64 25 77 25 42 25 75 25 41 25 47 25 77 25 41 25 62 25 77 25 42 25 68 25 41 25 47 25 51 25 41 25 52 25 67 25 42 25 70 25 41 25 47 25 77 25 41 25 5a 25 51 25 41 25 6f 25 41 25 43 25 49 } //1 %b%g%B%0%A%C%k%A%L%g%B%E%A%G%8%A%d%w%B%u%A%G%w%A%b%w%B%h%A%G%Q%A%R%g%B%p%A%G%w%A%Z%Q%A%o%A%C%I
		$a_01_5 = {40 62 40 67 40 42 40 30 40 41 40 43 40 6b 40 41 40 4c 40 67 40 42 40 45 40 41 40 47 40 38 40 41 40 64 40 77 40 42 40 75 40 41 40 47 40 77 40 41 40 62 40 77 40 42 40 68 40 41 40 47 40 51 40 41 40 52 40 67 40 42 40 70 40 41 40 47 40 77 40 41 40 5a 40 51 40 41 40 6f 40 41 40 43 40 49 } //1 @b@g@B@0@A@C@k@A@L@g@B@E@A@G@8@A@d@w@B@u@A@G@w@A@b@w@B@h@A@G@Q@A@R@g@B@p@A@G@w@A@Z@Q@A@o@A@C@I
		$a_01_6 = {5f 41 5f 47 5f 38 5f 41 5f 64 5f 77 5f 42 5f 75 5f 41 5f 47 5f 77 5f 41 5f 62 5f 77 5f 42 5f 68 5f 41 5f 47 5f 51 5f 41 5f 52 5f 67 5f 42 5f 70 5f 41 5f 47 5f 77 5f 41 5f 5a 5f 51 5f 41 5f 6f 5f 41 5f 43 5f 49 5f 41 5f 61 5f 41 5f 42 5f 30 5f 41 5f 48 5f 51 5f 41 5f } //1 _A_G_8_A_d_w_B_u_A_G_w_A_b_w_B_h_A_G_Q_A_R_g_B_p_A_G_w_A_Z_Q_A_o_A_C_I_A_a_A_B_0_A_H_Q_A_
		$a_01_7 = {21 41 21 47 21 38 21 41 21 64 21 77 21 42 21 75 21 41 21 47 21 77 21 41 21 62 21 77 21 42 21 68 21 41 21 47 21 51 21 41 21 52 21 67 21 42 21 70 21 41 21 47 21 77 21 41 21 5a 21 51 21 41 21 6f 21 41 21 43 21 49 21 41 21 61 21 41 21 42 21 30 21 41 21 48 21 51 21 41 21 } //1 !A!G!8!A!d!w!B!u!A!G!w!A!b!w!B!h!A!G!Q!A!R!g!B!p!A!G!w!A!Z!Q!A!o!A!C!I!A!a!A!B!0!A!H!Q!A!
		$a_01_8 = {5e 41 5e 47 5e 38 5e 41 5e 64 5e 77 5e 42 5e 75 5e 41 5e 47 5e 77 5e 41 5e 62 5e 77 5e 42 5e 68 5e 41 5e 47 5e 51 5e 41 5e 52 5e 67 5e 42 5e 70 5e 41 5e 47 5e 77 5e 41 5e 5a 5e 51 5e 41 5e 6f 5e 41 5e 43 5e 49 5e 41 5e 61 5e 41 5e 42 5e 30 5e 41 5e 48 5e 51 5e 41 5e } //1 ^A^G^8^A^d^w^B^u^A^G^w^A^b^w^B^h^A^G^Q^A^R^g^B^p^A^G^w^A^Z^Q^A^o^A^C^I^A^a^A^B^0^A^H^Q^A^
	condition:
		((#a_03_0  & 1)*2+(#a_03_1  & 1)*2+(#a_03_2  & 1)*2+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1) >=3
 
}