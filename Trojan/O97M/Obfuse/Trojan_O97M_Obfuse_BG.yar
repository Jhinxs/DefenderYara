
rule Trojan_O97M_Obfuse_BG{
	meta:
		description = "Trojan:O97M/Obfuse.BG,SIGNATURE_TYPE_MACROHSTR_EXT,01 00 01 00 03 00 00 "
		
	strings :
		$a_00_0 = {63 47 39 33 5a 58 4a 7a 61 47 56 73 62 43 35 6c 65 47 55 67 4c 55 56 34 5a 57 4e 31 64 47 6c 76 62 6c 42 76 62 47 6c 6a 65 53 42 43 65 58 42 68 63 33 } //1 cG93ZXJzaGVsbC5leGUgLUV4ZWN1dGlvblBvbGljeSBCeXBhc3
		$a_00_1 = {4c 56 64 70 62 6d 52 76 64 31 4e 30 65 57 78 6c 49 47 68 70 5a 47 52 6c 62 69 41 74 62 6d 39 73 62 32 64 76 49 43 31 75 62 33 42 79 62 32 5a 70 62 47 55 67 4c 57 } //1 LVdpbmRvd1N0eWxlIGhpZGRlbiAtbm9sb2dvIC1ub3Byb2ZpbGUgLW
		$a_00_2 = {53 55 56 59 4b 45 35 6c 64 79 31 50 59 6d 70 6c 59 33 51 67 54 6d 56 30 4c 6c 64 6c 59 6b 4e 73 61 57 56 75 64 43 6b 75 52 47 39 33 62 6d 78 76 59 57 52 47 61 57 78 6c 4b } //1 SUVYKE5ldy1PYmplY3QgTmV0LldlYkNsaWVudCkuRG93bmxvYWRGaWxlK
	condition:
		((#a_00_0  & 1)*1+(#a_00_1  & 1)*1+(#a_00_2  & 1)*1) >=1
 
}
rule Trojan_O97M_Obfuse_BG_2{
	meta:
		description = "Trojan:O97M/Obfuse.BG,SIGNATURE_TYPE_MACROHSTR_EXT,03 00 03 00 08 00 00 "
		
	strings :
		$a_01_0 = {50 72 69 76 61 74 65 20 53 75 62 20 44 6f 63 75 6d 65 6e 74 5f 6f 70 65 6e 28 29 } //1 Private Sub Document_open()
		$a_03_1 = {53 68 61 70 65 73 28 22 [0-20] 22 29 } //1
		$a_03_2 = {53 68 61 70 65 73 28 [0-20] 20 2b 20 22 [0-20] 22 20 2b 20 } //1
		$a_03_3 = {49 6e 74 65 72 61 63 74 69 6f 6e [0-05] 2e 53 68 65 6c 6c } //1
		$a_03_4 = {46 69 78 28 [0-20] 20 2b 20 48 65 78 28 [0-20] 29 } //1
		$a_03_5 = {53 68 61 70 65 73 28 [0-20] 29 2e 54 65 78 74 46 72 61 6d 65 2e 43 6f 6e 74 61 69 6e 69 6e 67 52 61 6e 67 65 } //1
		$a_03_6 = {3d 20 53 68 61 70 65 73 28 [0-20] 20 2b 20 [0-20] 20 2b 20 [0-02] 20 2b 20 [0-20] 20 2b 20 [0-20] 29 2e 54 65 78 74 46 72 61 6d 65 2e 43 6f 6e 74 61 69 6e 69 6e 67 52 61 6e 67 65 } //1
		$a_03_7 = {53 68 65 6c 6c 28 [0-20] 20 2b 20 [0-20] 20 2b 20 [0-20] 2c 20 [0-20] 29 } //1
	condition:
		((#a_01_0  & 1)*1+(#a_03_1  & 1)*1+(#a_03_2  & 1)*1+(#a_03_3  & 1)*1+(#a_03_4  & 1)*1+(#a_03_5  & 1)*1+(#a_03_6  & 1)*1+(#a_03_7  & 1)*1) >=3
 
}