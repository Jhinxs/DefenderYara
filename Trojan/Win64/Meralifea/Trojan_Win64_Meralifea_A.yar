
rule Trojan_Win64_Meralifea_A{
	meta:
		description = "Trojan:Win64/Meralifea.A,SIGNATURE_TYPE_PEHSTR_EXT,03 00 03 00 05 00 00 "
		
	strings :
		$a_03_0 = {48 85 c0 48 8b f0 0f 84 ?? ?? 00 00 44 8b 84 24 ?? ?? 00 00 48 8b 8c 24 ?? ?? 00 00 4c 8d 8c 24 ?? ?? 00 00 48 8b d0 48 89 5c 24 ?? ff 15 ?? ?? ?? ?? 85 c0 0f 84 ?? ?? 00 00 66 81 3e 4d 5a } //1
		$a_03_1 = {48 81 f9 fe ca 00 00 75 ?? 48 8b 44 24 28 48 85 c0 74 ?? 48 8d 0d ?? ?? ?? ?? 48 89 08 33 c0 c3 } //1
		$a_03_2 = {c7 44 24 28 10 00 00 00 48 89 6c 24 20 ff 15 ?? ?? ?? ?? f7 d8 1b c0 25 10 ff ed dc 05 cd cd cd cd } //1
		$a_01_3 = {81 f9 8e 4e 0e ec 75 10 41 0f b7 00 8b 0c 83 49 03 cb 48 89 4e 08 eb 16 81 f9 aa fc 0d 7c 75 0e } //1
		$a_80_4 = {5c 52 45 47 49 53 54 52 59 5c 4d 61 63 68 69 6e 65 5c 53 59 53 54 45 4d 5c 73 65 72 76 69 63 65 5c 69 61 53 74 6f 72 } //\REGISTRY\Machine\SYSTEM\service\iaStor  1
	condition:
		((#a_03_0  & 1)*1+(#a_03_1  & 1)*1+(#a_03_2  & 1)*1+(#a_01_3  & 1)*1+(#a_80_4  & 1)*1) >=3
 
}
rule Trojan_Win64_Meralifea_A_2{
	meta:
		description = "Trojan:Win64/Meralifea.A,SIGNATURE_TYPE_PEHSTR_EXT,05 00 05 00 0a 00 00 "
		
	strings :
		$a_01_0 = {bd 44 64 6b 20 } //1
		$a_01_1 = {74 14 66 81 39 4e 45 75 0d 48 63 51 04 48 03 d1 39 02 48 0f 44 c2 c3 } //2
		$a_01_2 = {41 b8 4b 41 50 43 } //1
		$a_01_3 = {ba 90 00 00 00 33 c9 41 b8 fe ca 00 00 ff 15 } //2
		$a_03_4 = {74 1b 41 83 fb 05 75 0a 80 3e e9 74 10 80 3e e8 74 0b 41 03 fb 49 03 f3 83 ff 06 72 ?? 83 ff 06 0f 82 ?? ?? 00 00 48 8b 4b 30 66 81 39 4d 5a } //2
		$a_03_5 = {74 0a 80 7f 05 cc 0f 85 ?? ?? 00 00 48 8b 4b 30 66 81 39 4d 5a } //2
		$a_01_6 = {75 0f 80 3f cc 74 15 80 3f 90 74 10 80 3f c3 } //2
		$a_80_7 = {5c 53 79 73 74 65 6d 72 6f 6f 74 5c 73 79 73 74 65 6d 33 32 5c 64 72 69 76 65 72 73 5c 25 77 5a } //\Systemroot\system32\drivers\%wZ  1
		$a_80_8 = {64 75 6d 70 5f 64 75 6d 70 66 76 65 2e 73 79 73 } //dump_dumpfve.sys  1
		$a_80_9 = {5c 4e 50 46 2d 7b 30 31 37 39 41 43 34 35 2d 43 32 32 36 2d 34 38 65 33 2d 41 32 30 35 2d 44 43 41 37 39 43 38 32 34 30 35 31 7d } //\NPF-{0179AC45-C226-48e3-A205-DCA79C824051}  1
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*2+(#a_01_2  & 1)*1+(#a_01_3  & 1)*2+(#a_03_4  & 1)*2+(#a_03_5  & 1)*2+(#a_01_6  & 1)*2+(#a_80_7  & 1)*1+(#a_80_8  & 1)*1+(#a_80_9  & 1)*1) >=5
 
}
rule Trojan_Win64_Meralifea_A_3{
	meta:
		description = "Trojan:Win64/Meralifea.A,SIGNATURE_TYPE_PEHSTR_EXT,0a 00 0a 00 12 00 00 "
		
	strings :
		$a_03_0 = {ba 30 00 22 00 48 89 46 08 44 8b 4c 24 ?? 49 8b 0c 24 48 8d 44 24 ?? 41 83 c1 28 48 89 44 24 ?? 89 7c 24 ?? 48 89 7c 24 ?? ff 15 ?? ?? ?? ?? 3b c7 74 ?? 48 8b 4c 24 68 ff 15 ?? ?? ?? ?? 48 8b 4c 24 60 ba 10 27 00 00 ff 15 ?? ?? ?? ?? 3b c7 75 ?? 48 8b 4c 24 ?? 48 8d 54 24 ?? ff 15 ?? ?? ?? ?? 81 7c 24 ?? dd cc bb aa } //2
		$a_03_1 = {c7 43 1c 00 00 10 00 ff 15 ?? ?? ?? ?? 3b c5 74 0a 8b 84 24 ?? 00 00 00 89 43 ?? 48 8b 0b 48 89 6c 24 ?? 48 8d 44 24 ?? 48 89 44 24 ?? 48 8d 44 24 ?? 45 33 c9 45 33 c0 ba 5c 40 07 00 } //2
		$a_03_2 = {ba 20 00 22 00 89 7c 24 ?? 48 89 44 24 ?? ff 15 ?? ?? ?? ?? f7 d8 1b c9 23 4c 24 ?? 81 f9 be ba fe ca } //2
		$a_03_3 = {ba 00 20 49 82 48 8b cb 44 89 6c 24 ?? 48 89 44 24 ?? 89 6c 24 ?? ff 15 ?? ?? ?? ?? 3b c5 74 0c 81 7c 24 ?? 46 55 53 45 } //2
		$a_03_4 = {8b 56 08 44 8b 84 24 ?? ?? 00 00 8b 4b ?? 41 03 d0 48 0f af d1 66 81 bc 24 ?? ?? 00 00 55 aa 75 } //2
		$a_03_5 = {ff 50 08 33 f6 48 3b c6 48 8b d8 74 ?? 8b 50 04 4c 8b 4c 24 ?? 48 8d 0c 52 48 8d 0c 8d 08 00 00 00 49 3b c9 73 ?? 66 81 38 38 9a } //2
		$a_80_6 = {2f 61 72 6b 73 69 67 2e 6a 73 } ///arksig.js  2
		$a_80_7 = {2f 62 69 6e 2f 69 33 38 36 2f 64 75 6d 70 2e 62 69 6e } ///bin/i386/dump.bin  1
		$a_80_8 = {2f 62 69 6e 2f 69 33 38 36 2f 6b 65 72 6e 65 6c 2e 62 69 6e } ///bin/i386/kernel.bin  1
		$a_80_9 = {2f 62 69 6e 2f 69 33 38 36 2f 6b 65 72 6e 65 6c 2e 73 69 67 } ///bin/i386/kernel.sig  1
		$a_80_10 = {2f 62 6f 6f 74 2f 62 6f 6f 74 2e 63 66 67 } ///boot/boot.cfg  1
		$a_80_11 = {2f 62 6f 6f 74 2f 6b 65 72 6e 65 6c } ///boot/kernel  1
		$a_80_12 = {2f 65 74 63 2f 63 72 79 70 74 6f 2e 6b 65 79 } ///etc/crypto.key  1
		$a_80_13 = {2f 65 74 63 2f 6f 72 69 67 69 6e 61 6c 2e 64 61 74 } ///etc/original.dat  1
		$a_80_14 = {2f 73 65 74 75 70 2e 69 6d 67 } ///setup.img  1
		$a_80_15 = {2f 73 69 6d 70 6c 69 66 69 65 64 2e 70 61 74 63 68 } ///simplified.patch  2
		$a_80_16 = {5c 5c 2e 5c 55 73 62 67 4b 72 6e 6c } //\\.\UsbgKrnl  1
		$a_80_17 = {45 46 49 20 50 41 52 54 } //EFI PART  1
	condition:
		((#a_03_0  & 1)*2+(#a_03_1  & 1)*2+(#a_03_2  & 1)*2+(#a_03_3  & 1)*2+(#a_03_4  & 1)*2+(#a_03_5  & 1)*2+(#a_80_6  & 1)*2+(#a_80_7  & 1)*1+(#a_80_8  & 1)*1+(#a_80_9  & 1)*1+(#a_80_10  & 1)*1+(#a_80_11  & 1)*1+(#a_80_12  & 1)*1+(#a_80_13  & 1)*1+(#a_80_14  & 1)*1+(#a_80_15  & 1)*2+(#a_80_16  & 1)*1+(#a_80_17  & 1)*1) >=10
 
}