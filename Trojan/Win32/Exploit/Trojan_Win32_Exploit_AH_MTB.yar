
rule Trojan_Win32_Exploit_AH_MTB{
	meta:
		description = "Trojan:Win32/Exploit.AH!MTB,SIGNATURE_TYPE_PEHSTR_EXT,15 00 15 00 07 00 00 "
		
	strings :
		$a_81_0 = {70 61 79 4c 6f 61 64 } //3 payLoad
		$a_81_1 = {53 74 61 72 74 75 70 49 6e 66 6f } //3 StartupInfo
		$a_81_2 = {43 56 45 2d 32 30 32 31 2d 33 31 39 35 36 2d 45 58 50 2d 6d 61 69 6e } //3 CVE-2021-31956-EXP-main
		$a_81_3 = {43 6f 6e 76 65 72 74 53 74 72 69 6e 67 53 65 63 75 72 69 74 79 44 65 73 63 72 69 70 74 6f 72 54 6f 53 65 63 75 72 69 74 79 44 65 73 63 72 69 70 74 6f 72 41 } //3 ConvertStringSecurityDescriptorToSecurityDescriptorA
		$a_81_4 = {43 6f 6e 73 6f 6c 65 41 70 70 6c 69 63 61 74 69 6f 6e 31 31 2e 70 64 62 } //3 ConsoleApplication11.pdb
		$a_81_5 = {5a 77 53 65 74 45 61 46 69 6c 65 } //3 ZwSetEaFile
		$a_81_6 = {4e 74 43 72 65 61 74 65 57 6e 66 53 74 61 74 65 4e 61 6d 65 } //3 NtCreateWnfStateName
	condition:
		((#a_81_0  & 1)*3+(#a_81_1  & 1)*3+(#a_81_2  & 1)*3+(#a_81_3  & 1)*3+(#a_81_4  & 1)*3+(#a_81_5  & 1)*3+(#a_81_6  & 1)*3) >=21
 
}