
rule Trojan_Win32_Matsnu_M_{
	meta:
		description = "Trojan:Win32/Matsnu.M!!Matsnu.gen!A,SIGNATURE_TYPE_ARHSTR_EXT,0a 00 0a 00 10 00 00 "
		
	strings :
		$a_80_0 = {64 6c 6c 6c 69 73 74 3d 25 73 26 70 72 6f 63 6c 69 73 74 3d 25 73 } //dlllist=%s&proclist=%s  2
		$a_80_1 = {69 64 3d 25 73 26 6d 79 6e 75 6d 3d 25 75 26 76 65 72 3d 25 73 26 63 76 72 3d 25 75 26 74 68 72 65 61 64 69 64 3d 25 75 } //id=%s&mynum=%u&ver=%s&cvr=%u&threadid=%u  3
		$a_80_2 = {26 6c 61 6e 67 3d 30 78 25 30 34 58 26 6f 73 3d 25 73 26 63 72 63 62 6c 77 3d 25 30 38 78 26 25 73 } //&lang=0x%04X&os=%s&crcblw=%08x&%s  3
		$a_80_3 = {47 45 54 3d 25 73 26 41 45 53 3d 25 73 } //GET=%s&AES=%s  1
		$a_80_4 = {69 64 74 3d 25 75 26 63 6f 64 65 3d 25 75 } //idt=%u&code=%u  1
		$a_80_5 = {67 65 74 3d 72 61 70 6f 72 74 } //get=raport  1
		$a_80_6 = {67 65 74 3d 73 79 73 69 6e 66 6f } //get=sysinfo  1
		$a_80_7 = {00 45 4e 44 44 44 44 44 00 } //  1
		$a_03_8 = {50 4f 53 54 ?? ?? ?? 00 ?? ?? ?? 48 54 54 50 } //1
		$a_03_9 = {30 32 64 20 ?? ?? ?? ?? ?? ?? ?? 47 4d ?? ?? ?? ?? ff ff 54 } //1
		$a_01_10 = {ff 52 43 50 4b } //1
		$a_03_11 = {43 4f 4d 50 ?? ?? ?? 4c 45 54 45 } //1
		$a_01_12 = {e8 11 00 00 00 43 55 52 52 45 4e 54 25 30 38 58 4d 55 54 45 58 00 } //1
		$a_01_13 = {e8 05 00 00 00 2e 64 6c 6c 00 8d 95 f0 fe ff ff 52 ff 93 } //2
		$a_01_14 = {e8 0a 00 00 00 2f 25 73 3a 2a 2d 2d 25 73 00 } //2
		$a_01_15 = {30 d0 31 c9 b1 08 d3 ea f8 d1 d8 73 05 35 20 83 b8 ed } //1
	condition:
		((#a_80_0  & 1)*2+(#a_80_1  & 1)*3+(#a_80_2  & 1)*3+(#a_80_3  & 1)*1+(#a_80_4  & 1)*1+(#a_80_5  & 1)*1+(#a_80_6  & 1)*1+(#a_80_7  & 1)*1+(#a_03_8  & 1)*1+(#a_03_9  & 1)*1+(#a_01_10  & 1)*1+(#a_03_11  & 1)*1+(#a_01_12  & 1)*1+(#a_01_13  & 1)*2+(#a_01_14  & 1)*2+(#a_01_15  & 1)*1) >=10
 
}
rule Trojan_Win32_Matsnu_M__2{
	meta:
		description = "Trojan:Win32/Matsnu.M!!Matsnu.gen!A,SIGNATURE_TYPE_ARHSTR_EXT,05 00 05 00 11 00 00 "
		
	strings :
		$a_00_0 = {3d 63 6f 6e 66 69 67 26 75 70 67 72 61 64 65 3d 25 75 26 63 72 61 73 68 65 64 3d 25 75 } //1 =config&upgrade=%u&crashed=%u
		$a_00_1 = {3d 67 65 74 73 65 6e 64 65 72 73 74 6f 63 68 65 63 6b } //1 =getsenderstocheck
		$a_00_2 = {3d 6d 61 69 6e 62 6f 64 79 26 68 61 73 68 3d 25 73 26 74 61 73 6b 3d 25 75 } //1 =mainbody&hash=%s&task=%u
		$a_00_3 = {3d 72 65 70 6f 72 74 26 74 61 73 6b 3d 25 75 26 74 68 72 65 61 64 69 64 3d 25 75 } //1 =report&task=%u&threadid=%u
		$a_00_4 = {3d 25 73 26 76 65 72 3d 25 73 26 63 76 72 3d 25 75 26 73 74 74 68 3d 25 75 3a 25 75 26 74 68 72 65 61 64 69 64 3d 25 75 26 6c 61 6e 67 3d 30 78 25 30 34 58 26 6f 73 3d 25 73 26 25 73 } //1 =%s&ver=%s&cvr=%u&stth=%u:%u&threadid=%u&lang=0x%04X&os=%s&%s
		$a_00_5 = {3d 25 75 26 67 65 74 3d 73 65 6e 64 65 72 63 68 65 63 6b 72 65 70 6f 72 74 26 74 68 72 65 61 64 69 64 3d 25 75 } //1 =%u&get=sendercheckreport&threadid=%u
		$a_00_6 = {73 65 6e 64 65 64 3d 25 75 26 65 72 72 6f 72 3d 25 75 26 65 78 65 72 72 3d 25 75 26 74 69 6d 65 3d 25 75 26 72 65 73 75 6c 74 3d 25 73 26 74 61 62 6c 65 3d 25 73 26 72 65 6d 61 72 6b 3d 25 73 } //1 sended=%u&error=%u&exerr=%u&time=%u&result=%s&table=%s&remark=%s
		$a_00_7 = {74 68 69 64 3d 25 75 26 63 6f 75 6e 74 3d 25 75 26 65 72 72 6f 72 3d 25 75 26 74 69 6d 65 3d 25 75 26 72 65 61 6c 3d 25 75 26 73 65 6e 64 65 72 73 3d 25 73 26 74 61 62 6c 65 3d 25 73 26 72 65 6d 61 72 6b 3d 25 73 26 6e 6f 73 6d 74 70 3d 25 73 } //1 thid=%u&count=%u&error=%u&time=%u&real=%u&senders=%s&table=%s&remark=%s&nosmtp=%s
		$a_00_8 = {7b 4c 65 74 5f 75 6e 69 71 5f 69 64 3d } //1 {Let_uniq_id=
		$a_00_9 = {7b 4c 65 74 5f 6f 6e 65 5f 69 64 3d } //1 {Let_one_id=
		$a_00_10 = {2f 46 20 2f 46 49 20 22 55 53 45 52 4e 41 4d 45 20 65 71 20 25 73 22 20 2f 46 49 20 22 50 49 44 20 6e 65 20 25 75 22 20 2f 49 4d 20 64 6c 6c 68 6f 73 74 2e 65 78 65 } //1 /F /FI "USERNAME eq %s" /FI "PID ne %u" /IM dllhost.exe
		$a_03_11 = {50 4f 53 54 c6 45 ?? 00 c7 45 ?? 48 54 54 50 c7 45 ?? 2f 31 2e 30 } //1
		$a_03_12 = {e8 0f 00 00 00 3d 3f 75 74 66 2d 38 3f ?? 3f 25 73 3f 3d 00 } //1
		$a_03_13 = {45 48 4c 4f 66 c7 45 ?? 20 25 c6 45 ?? 73 c6 45 ?? 0d c6 45 ?? 0a c6 45 ?? 00 } //1
		$a_03_14 = {53 54 41 52 c7 45 ?? 54 54 4c 53 c6 45 ?? 0d c6 45 ?? 0a c6 45 ?? 00 } //1
		$a_03_15 = {5b 63 6f 6d 66 c7 45 ?? 61 5d c6 45 ?? 00 c7 45 ?? 5b 64 64 6f 66 c7 45 ?? 74 5d c6 45 ?? 00 c7 45 ?? 5b 64 6f 67 } //1
		$a_03_16 = {50 4b 66 c7 85 ?? ?? ff ff 50 4b 66 c7 85 ?? ?? ff ff 03 04 66 c7 85 ?? ?? ff ff 01 02 } //1
	condition:
		((#a_00_0  & 1)*1+(#a_00_1  & 1)*1+(#a_00_2  & 1)*1+(#a_00_3  & 1)*1+(#a_00_4  & 1)*1+(#a_00_5  & 1)*1+(#a_00_6  & 1)*1+(#a_00_7  & 1)*1+(#a_00_8  & 1)*1+(#a_00_9  & 1)*1+(#a_00_10  & 1)*1+(#a_03_11  & 1)*1+(#a_03_12  & 1)*1+(#a_03_13  & 1)*1+(#a_03_14  & 1)*1+(#a_03_15  & 1)*1+(#a_03_16  & 1)*1) >=5
 
}