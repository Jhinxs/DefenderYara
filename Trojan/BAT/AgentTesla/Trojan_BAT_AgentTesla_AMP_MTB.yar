
rule Trojan_BAT_AgentTesla_AMP_MTB{
	meta:
		description = "Trojan:BAT/AgentTesla.AMP!MTB,SIGNATURE_TYPE_PEHSTR_EXT,07 00 07 00 07 00 00 "
		
	strings :
		$a_81_0 = {57 72 61 70 4e 6f 6e 45 78 63 65 70 74 69 6f 6e 54 68 72 6f 77 73 } //1 WrapNonExceptionThrows
		$a_81_1 = {4d 65 64 49 6d 6d 75 6e 65 } //1 MedImmune
		$a_81_2 = {4d 65 64 49 6d 6d 75 6e 65 20 44 69 73 74 72 69 62 75 74 69 6f 6e } //1 MedImmune Distribution
		$a_81_3 = {41 73 74 72 61 5a 65 6e 65 63 61 } //1 AstraZeneca
		$a_81_4 = {41 73 74 72 61 5a 65 6e 65 63 61 20 70 6c 63 } //1 AstraZeneca plc
		$a_81_5 = {24 62 61 35 66 62 30 38 32 2d 37 66 33 35 2d 34 38 35 34 2d 39 37 61 66 2d 37 30 35 61 66 63 33 31 38 32 31 32 } //1 $ba5fb082-7f35-4854-97af-705afc318212
		$a_81_6 = {6f 70 5f 45 71 75 61 6c 69 74 79 } //1 op_Equality
	condition:
		((#a_81_0  & 1)*1+(#a_81_1  & 1)*1+(#a_81_2  & 1)*1+(#a_81_3  & 1)*1+(#a_81_4  & 1)*1+(#a_81_5  & 1)*1+(#a_81_6  & 1)*1) >=7
 
}
rule Trojan_BAT_AgentTesla_AMP_MTB_2{
	meta:
		description = "Trojan:BAT/AgentTesla.AMP!MTB,SIGNATURE_TYPE_PEHSTR_EXT,08 00 08 00 08 00 00 "
		
	strings :
		$a_01_0 = {43 00 53 00 2e 00 52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 73 00 } //1 CS.Resources
		$a_01_1 = {46 00 72 00 6f 00 6d 00 42 00 61 00 73 00 65 00 36 00 34 00 53 00 74 00 72 00 69 00 6e 00 67 00 } //1 FromBase64String
		$a_01_2 = {5c 00 64 00 62 00 2e 00 61 00 63 00 63 00 64 00 62 00 3b 00 } //1 \db.accdb;
		$a_01_3 = {78 00 75 00 78 00 69 00 78 00 78 00 } //1 xuxixx
		$a_01_4 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 74 00 65 00 6d 00 70 00 75 00 72 00 69 00 2e 00 6f 00 72 00 67 00 2f 00 64 00 62 00 44 00 61 00 74 00 61 00 53 00 65 00 74 00 43 00 68 00 75 00 72 00 63 00 68 00 2e 00 78 00 73 00 64 00 } //1 http://tempuri.org/dbDataSetChurch.xsd
		$a_01_5 = {57 00 69 00 6e 00 46 00 6f 00 72 00 6d 00 73 00 5f 00 52 00 65 00 63 00 75 00 72 00 73 00 69 00 76 00 65 00 46 00 6f 00 72 00 6d 00 43 00 72 00 65 00 61 00 74 00 65 00 } //1 WinForms_RecursiveFormCreate
		$a_01_6 = {57 00 69 00 6e 00 46 00 6f 00 72 00 6d 00 73 00 5f 00 53 00 65 00 65 00 49 00 6e 00 6e 00 65 00 72 00 45 00 78 00 63 00 65 00 70 00 74 00 69 00 6f 00 6e 00 } //1 WinForms_SeeInnerException
		$a_81_7 = {24 35 31 32 65 39 31 33 64 2d 31 63 35 61 2d 34 34 64 31 2d 62 63 37 65 2d 61 37 63 65 35 63 66 63 64 64 32 35 } //1 $512e913d-1c5a-44d1-bc7e-a7ce5cfcdd25
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_81_7  & 1)*1) >=8
 
}
rule Trojan_BAT_AgentTesla_AMP_MTB_3{
	meta:
		description = "Trojan:BAT/AgentTesla.AMP!MTB,SIGNATURE_TYPE_PEHSTR_EXT,0d 00 0d 00 0d 00 00 "
		
	strings :
		$a_81_0 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 53 65 61 72 63 68 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.Search.resources
		$a_81_1 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 63 72 79 73 74 61 6c 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.crystal.resources
		$a_81_2 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 4b 69 6e 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.Kin.resources
		$a_81_3 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 66 72 6d 4d 61 69 6e 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.frmMain.resources
		$a_81_4 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 41 64 64 49 6e 66 6f 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.AddInfo.resources
		$a_81_5 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 55 70 64 61 74 65 49 6e 66 6f 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.UpdateInfo.resources
		$a_81_6 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 44 65 6c 65 74 65 69 6e 66 6f 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.Deleteinfo.resources
		$a_81_7 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 50 72 6f 70 65 72 74 69 65 73 2e 52 65 73 6f 75 72 63 65 73 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.Properties.Resources.resources
		$a_81_8 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 70 72 6f 64 75 63 74 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.product.resources
		$a_81_9 = {49 53 4f 32 30 32 32 4d 6f 64 65 73 2e 76 69 65 77 2e 72 65 73 6f 75 72 63 65 73 } //1 ISO2022Modes.view.resources
		$a_01_10 = {63 00 72 00 79 00 72 00 70 00 74 00 62 00 74 00 6e 00 } //1 cryrptbtn
		$a_01_11 = {66 00 72 00 6d 00 4d 00 61 00 69 00 6e 00 } //1 frmMain
		$a_01_12 = {35 00 35 00 33 00 55 00 42 00 4b 00 37 00 42 00 47 00 46 00 46 00 34 00 38 00 38 00 5a 00 35 00 34 00 38 00 5a 00 55 00 35 00 46 00 } //1 553UBK7BGFF488Z548ZU5F
	condition:
		((#a_81_0  & 1)*1+(#a_81_1  & 1)*1+(#a_81_2  & 1)*1+(#a_81_3  & 1)*1+(#a_81_4  & 1)*1+(#a_81_5  & 1)*1+(#a_81_6  & 1)*1+(#a_81_7  & 1)*1+(#a_81_8  & 1)*1+(#a_81_9  & 1)*1+(#a_01_10  & 1)*1+(#a_01_11  & 1)*1+(#a_01_12  & 1)*1) >=13
 
}
rule Trojan_BAT_AgentTesla_AMP_MTB_4{
	meta:
		description = "Trojan:BAT/AgentTesla.AMP!MTB,SIGNATURE_TYPE_PEHSTR_EXT,0f 00 0f 00 10 00 00 "
		
	strings :
		$a_81_0 = {44 6f 77 6e 6c 6f 61 64 57 65 62 } //1 DownloadWeb
		$a_81_1 = {41 70 70 65 6e 64 } //1 Append
		$a_81_2 = {52 65 70 6c 61 63 65 } //1 Replace
		$a_81_3 = {67 65 74 5f 43 75 72 72 65 6e 74 } //1 get_Current
		$a_81_4 = {43 6f 6e 76 65 72 74 } //1 Convert
		$a_81_5 = {5f 6f 6b 71 77 64 6f 71 77 6b 6f 64 71 77 } //1 _okqwdoqwkodqw
		$a_81_6 = {6f 70 5f 45 71 75 61 6c 69 74 79 } //1 op_Equality
		$a_01_7 = {52 00 41 00 4e 00 44 00 4f 00 4d 00 5f 00 53 00 54 00 52 00 49 00 4e 00 47 00 } //1 RANDOM_STRING
		$a_01_8 = {5b 00 53 00 50 00 4c 00 49 00 54 00 54 00 45 00 52 00 5d 00 } //1 [SPLITTER]
		$a_01_9 = {4c 00 49 00 4e 00 4b 00 53 00 5f 00 48 00 45 00 52 00 45 00 } //1 LINKS_HERE
		$a_01_10 = {78 00 78 00 78 00 44 00 78 00 78 00 78 00 6f 00 78 00 78 00 78 00 77 00 78 00 78 00 78 00 6e 00 78 00 78 00 78 00 6c 00 78 00 78 00 6f 00 78 00 78 00 61 00 78 00 64 00 78 00 53 00 78 00 74 00 78 00 72 00 78 00 69 00 78 00 78 00 6e 00 78 00 78 00 67 00 78 00 } //1 xxxDxxxoxxxwxxxnxxxlxxoxxaxdxSxtxrxixxnxxgx
		$a_01_11 = {78 00 47 00 78 00 78 00 78 00 65 00 78 00 78 00 74 00 78 00 78 00 54 00 78 00 79 00 78 00 70 00 78 00 65 00 78 00 } //1 xGxxxexxtxxTxyxpxex
		$a_01_12 = {78 00 78 00 78 00 41 00 78 00 78 00 73 00 78 00 78 00 73 00 78 00 78 00 65 00 78 00 6d 00 78 00 78 00 62 00 78 00 78 00 6c 00 78 00 78 00 79 00 78 00 } //1 xxxAxxsxxsxxexmxxbxxlxxyx
		$a_01_13 = {78 00 78 00 78 00 4c 00 78 00 78 00 6f 00 78 00 78 00 78 00 78 00 78 00 61 00 78 00 78 00 64 00 78 00 78 00 78 00 } //1 xxxLxxoxxxxxaxxdxxx
		$a_01_14 = {78 00 78 00 78 00 45 00 78 00 78 00 6e 00 78 00 78 00 74 00 72 00 78 00 78 00 78 00 79 00 78 00 78 00 78 00 50 00 78 00 78 00 78 00 6f 00 78 00 78 00 69 00 78 00 78 00 78 00 6e 00 78 00 78 00 74 00 78 00 78 00 78 00 78 00 } //1 xxxExxnxxtrxxxyxxxPxxxoxxixxxnxxtxxxx
		$a_01_15 = {78 00 78 00 78 00 49 00 78 00 78 00 6e 00 78 00 78 00 76 00 78 00 6f 00 78 00 6b 00 78 00 65 00 78 00 78 00 } //1 xxxIxxnxxvxoxkxexx
	condition:
		((#a_81_0  & 1)*1+(#a_81_1  & 1)*1+(#a_81_2  & 1)*1+(#a_81_3  & 1)*1+(#a_81_4  & 1)*1+(#a_81_5  & 1)*1+(#a_81_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1+(#a_01_9  & 1)*1+(#a_01_10  & 1)*1+(#a_01_11  & 1)*1+(#a_01_12  & 1)*1+(#a_01_13  & 1)*1+(#a_01_14  & 1)*1+(#a_01_15  & 1)*1) >=15
 
}
rule Trojan_BAT_AgentTesla_AMP_MTB_5{
	meta:
		description = "Trojan:BAT/AgentTesla.AMP!MTB,SIGNATURE_TYPE_PEHSTR_EXT,0e 00 0e 00 0e 00 00 "
		
	strings :
		$a_81_0 = {72 6b 51 75 41 74 64 50 32 76 32 44 43 38 58 61 4a 53 65 } //1 rkQuAtdP2v2DC8XaJSe
		$a_81_1 = {6c 68 63 56 38 78 64 52 45 50 79 43 4c 33 56 6d 69 6f 44 } //1 lhcV8xdREPyCL3VmioD
		$a_81_2 = {6c 39 48 75 34 69 64 41 50 59 55 6d 42 43 5a 74 4e 6c 4b } //1 l9Hu4idAPYUmBCZtNlK
		$a_81_3 = {44 65 62 75 67 67 65 72 4e 6f 6e 55 73 65 72 43 6f 64 65 41 74 74 72 69 62 75 74 65 } //1 DebuggerNonUserCodeAttribute
		$a_81_4 = {44 65 62 75 67 67 61 62 6c 65 41 74 74 72 69 62 75 74 65 } //1 DebuggableAttribute
		$a_81_5 = {44 65 62 75 67 67 65 72 42 72 6f 77 73 61 62 6c 65 41 74 74 72 69 62 75 74 65 } //1 DebuggerBrowsableAttribute
		$a_81_6 = {45 64 69 74 6f 72 42 72 6f 77 73 61 62 6c 65 41 74 74 72 69 62 75 74 65 } //1 EditorBrowsableAttribute
		$a_81_7 = {70 61 73 73 77 6f 72 64 48 61 73 68 69 6e 67 } //1 passwordHashing
		$a_81_8 = {54 6f 42 61 73 65 36 34 53 74 72 69 6e 67 } //1 ToBase64String
		$a_81_9 = {53 63 68 6f 6f 6c 4d 61 6e 61 67 65 6d 65 6e 74 53 79 73 74 65 6d 2e 50 72 6f 70 65 72 74 69 65 73 } //1 SchoolManagementSystem.Properties
		$a_01_10 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 74 00 65 00 6d 00 70 00 75 00 72 00 69 00 2e 00 6f 00 72 00 67 00 2f 00 53 00 63 00 68 00 6f 00 6f 00 6c 00 4d 00 61 00 6e 00 61 00 67 00 65 00 6d 00 65 00 6e 00 74 00 53 00 79 00 73 00 74 00 65 00 6d 00 44 00 61 00 74 00 61 00 53 00 65 00 74 00 2e 00 78 00 73 00 64 00 } //1 http://tempuri.org/SchoolManagementSystemDataSet.xsd
		$a_01_11 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 74 00 65 00 6d 00 70 00 75 00 72 00 69 00 2e 00 6f 00 72 00 67 00 2f 00 53 00 63 00 68 00 6f 00 6f 00 6c 00 4d 00 61 00 6e 00 61 00 67 00 65 00 6d 00 65 00 6e 00 74 00 53 00 79 00 73 00 74 00 65 00 6d 00 44 00 61 00 74 00 61 00 53 00 65 00 74 00 31 00 2e 00 78 00 73 00 64 00 } //1 http://tempuri.org/SchoolManagementSystemDataSet1.xsd
		$a_01_12 = {68 00 74 00 74 00 70 00 3a 00 2f 00 2f 00 74 00 65 00 6d 00 70 00 75 00 72 00 69 00 2e 00 6f 00 72 00 67 00 2f 00 53 00 63 00 68 00 6f 00 6f 00 6c 00 4d 00 61 00 6e 00 61 00 67 00 65 00 6d 00 65 00 6e 00 74 00 53 00 79 00 73 00 74 00 65 00 6d 00 44 00 61 00 74 00 61 00 53 00 65 00 74 00 32 00 2e 00 78 00 73 00 64 00 } //1 http://tempuri.org/SchoolManagementSystemDataSet2.xsd
		$a_81_13 = {24 63 62 65 39 34 38 38 37 2d 34 61 62 64 2d 34 63 61 63 2d 38 65 37 63 2d 35 31 33 64 34 38 33 33 30 39 61 32 } //1 $cbe94887-4abd-4cac-8e7c-513d483309a2
	condition:
		((#a_81_0  & 1)*1+(#a_81_1  & 1)*1+(#a_81_2  & 1)*1+(#a_81_3  & 1)*1+(#a_81_4  & 1)*1+(#a_81_5  & 1)*1+(#a_81_6  & 1)*1+(#a_81_7  & 1)*1+(#a_81_8  & 1)*1+(#a_81_9  & 1)*1+(#a_01_10  & 1)*1+(#a_01_11  & 1)*1+(#a_01_12  & 1)*1+(#a_81_13  & 1)*1) >=14
 
}
rule Trojan_BAT_AgentTesla_AMP_MTB_6{
	meta:
		description = "Trojan:BAT/AgentTesla.AMP!MTB,SIGNATURE_TYPE_PEHSTR_EXT,13 00 13 00 13 00 00 "
		
	strings :
		$a_01_0 = {7b 00 31 00 31 00 31 00 31 00 31 00 2d 00 32 00 32 00 32 00 32 00 32 00 2d 00 35 00 30 00 30 00 30 00 31 00 2d 00 30 00 30 00 30 00 30 00 30 00 7d 00 } //1 {11111-22222-50001-00000}
		$a_01_1 = {47 00 65 00 74 00 44 00 65 00 6c 00 65 00 67 00 61 00 74 00 65 00 46 00 6f 00 72 00 46 00 75 00 6e 00 63 00 74 00 69 00 6f 00 6e 00 50 00 6f 00 69 00 6e 00 74 00 65 00 72 00 } //1 GetDelegateForFunctionPointer
		$a_01_2 = {66 00 69 00 6c 00 65 00 3a 00 2f 00 2f 00 2f 00 } //1 file:///
		$a_01_3 = {46 00 69 00 6e 00 64 00 } //1 Find
		$a_01_4 = {52 00 65 00 73 00 6f 00 75 00 72 00 63 00 65 00 41 00 } //1 ResourceA
		$a_01_5 = {56 00 69 00 72 00 74 00 75 00 61 00 6c 00 } //1 Virtual
		$a_01_6 = {41 00 6c 00 6c 00 6f 00 63 00 } //1 Alloc
		$a_01_7 = {57 00 72 00 69 00 74 00 65 00 } //1 Write
		$a_01_8 = {50 00 72 00 6f 00 63 00 65 00 73 00 73 00 } //1 Process
		$a_01_9 = {4d 00 65 00 6d 00 6f 00 72 00 79 00 } //1 Memory
		$a_01_10 = {50 00 72 00 6f 00 74 00 65 00 63 00 74 00 } //1 Protect
		$a_01_11 = {4f 00 70 00 65 00 6e 00 } //1 Open
		$a_01_12 = {43 00 6c 00 6f 00 73 00 65 00 } //1 Close
		$a_01_13 = {48 00 61 00 6e 00 64 00 6c 00 65 00 } //1 Handle
		$a_01_14 = {53 00 79 00 73 00 74 00 65 00 6d 00 2e 00 53 00 65 00 63 00 75 00 72 00 69 00 74 00 79 00 2e 00 43 00 72 00 79 00 70 00 74 00 6f 00 67 00 72 00 61 00 70 00 68 00 79 00 2e 00 41 00 65 00 73 00 43 00 72 00 79 00 70 00 74 00 6f 00 53 00 65 00 72 00 76 00 69 00 63 00 65 00 50 00 72 00 6f 00 76 00 69 00 64 00 65 00 72 00 } //1 System.Security.Cryptography.AesCryptoServiceProvider
		$a_01_15 = {55 00 48 00 58 00 48 00 31 00 52 00 6d 00 6f 00 42 00 6b 00 50 00 52 00 55 00 73 00 79 00 64 00 50 00 53 00 2e 00 6e 00 6e 00 6e 00 55 00 50 00 79 00 68 00 42 00 6a 00 6e 00 64 00 72 00 78 00 58 00 41 00 35 00 79 00 6e 00 } //1 UHXH1RmoBkPRUsydPS.nnnUPyhBjndrxXA5yn
		$a_01_16 = {7b 00 31 00 31 00 31 00 31 00 31 00 2d 00 32 00 32 00 32 00 32 00 32 00 2d 00 31 00 30 00 30 00 30 00 39 00 2d 00 31 00 31 00 31 00 31 00 32 00 7d 00 } //1 {11111-22222-10009-11112}
		$a_01_17 = {66 00 6e 00 53 00 32 00 6d 00 6c 00 4e 00 68 00 4e 00 42 00 79 00 53 00 69 00 39 00 65 00 62 00 69 00 62 00 2e 00 72 00 58 00 56 00 58 00 6f 00 4d 00 5a 00 4e 00 57 00 4a 00 66 00 5a 00 55 00 57 00 34 00 33 00 43 00 61 00 } //1 fnS2mlNhNBySi9ebib.rXVXoMZNWJfZUW43Ca
		$a_01_18 = {30 00 30 00 30 00 30 00 30 00 34 00 62 00 30 00 } //1 000004b0
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1+(#a_01_9  & 1)*1+(#a_01_10  & 1)*1+(#a_01_11  & 1)*1+(#a_01_12  & 1)*1+(#a_01_13  & 1)*1+(#a_01_14  & 1)*1+(#a_01_15  & 1)*1+(#a_01_16  & 1)*1+(#a_01_17  & 1)*1+(#a_01_18  & 1)*1) >=19
 
}