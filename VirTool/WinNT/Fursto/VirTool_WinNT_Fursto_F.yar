
rule VirTool_WinNT_Fursto_F{
	meta:
		description = "VirTool:WinNT/Fursto.F,SIGNATURE_TYPE_PEHSTR_EXT,14 00 10 00 0f 00 00 "
		
	strings :
		$a_02_0 = {53 54 41 52 54 45 44 [0-02] 49 6e 73 74 61 6c 6c 48 6f 6f 6b 73 3a [0-04] 53 55 43 43 45 53 53 [0-02] 69 6e 73 74 61 6c 6c 48 6f 6f 6b 73 3a [0-04] 46 41 49 4c 45 44 [0-04] 49 6e 73 74 61 6c 6c 48 6f 6f 6b 73 3a } //4
		$a_02_1 = {53 54 41 52 54 45 44 [0-02] 52 65 68 6f 6f 6b 20 74 68 72 65 61 64 3a [0-04] 45 58 49 54 [0-05] 52 65 68 6f 6f 6b 20 74 68 72 65 61 64 3a [0-04] 52 45 48 4f 4f 4b 45 44 [0-04] 52 65 68 6f 6f 6b 20 74 68 72 65 61 64 3a [0-04] 46 41 49 4c 45 44 [0-04] 52 65 68 6f 6f 6b 20 74 68 72 65 61 64 3a [0-04] 45 58 43 45 50 54 49 4f 4e [0-04] 52 65 68 6f 6f 6b 20 74 68 72 65 61 64 } //4
		$a_02_2 = {53 54 41 52 54 45 44 [0-02] 52 65 73 6f 6c 76 65 20 74 68 72 65 61 64 3a [0-08] 45 58 49 54 [0-08] 52 65 73 6f 6c 76 65 20 74 68 72 65 61 64 3a [0-08] 45 58 43 45 50 54 49 4f 4e [0-04] 47 65 74 44 6f 73 4e 61 6d 65 54 68 72 65 61 64 50 72 6f 63 3a } //4
		$a_00_3 = {4c 6f 61 64 4f 70 74 69 6f 6e 73 3a 20 64 72 69 76 65 72 20 69 6d 61 67 65 20 66 69 6c 65 20 70 61 74 68 20 3d } //1 LoadOptions: driver image file path =
		$a_00_4 = {4c 6f 61 64 4f 70 74 69 6f 6e 73 3a 20 64 72 69 76 65 72 20 64 69 72 65 63 74 6f 72 79 20 5b 4e 54 5d 20 3d } //1 LoadOptions: driver directory [NT] =
		$a_00_5 = {4c 6f 61 64 4f 70 74 69 6f 6e 73 3a 20 64 72 69 76 65 72 20 64 69 72 65 63 74 6f 72 79 20 5b 44 4f 53 5d 20 3d } //1 LoadOptions: driver directory [DOS] =
		$a_00_6 = {47 65 74 4b 65 72 6e 65 6c 43 61 6c 6c 73 41 64 64 72 65 73 73 65 73 20 28 57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32 30 30 33 2c 20 62 75 69 6c 64 20 33 37 39 30 29 3a } //1 GetKernelCallsAddresses (Windows Server 2003, build 3790):
		$a_00_7 = {47 65 74 4b 65 72 6e 65 6c 43 61 6c 6c 73 41 64 64 72 65 73 73 65 73 20 28 57 69 6e 64 6f 77 73 20 58 50 2c 20 62 75 69 6c 64 20 32 36 30 30 29 3a } //1 GetKernelCallsAddresses (Windows XP, build 2600):
		$a_00_8 = {47 65 74 4b 65 72 6e 65 6c 43 61 6c 6c 73 41 64 64 72 65 73 73 65 73 20 28 57 69 6e 64 6f 77 73 20 32 30 30 30 2c 20 62 75 69 6c 64 20 32 31 39 35 29 3a } //1 GetKernelCallsAddresses (Windows 2000, build 2195):
		$a_00_9 = {45 52 52 4f 52 2c 20 47 65 74 4b 65 72 6e 65 6c 43 61 6c 6c 73 41 64 64 72 65 73 73 65 73 28 29 20 66 61 69 6c 65 64 } //1 ERROR, GetKernelCallsAddresses() failed
		$a_00_10 = {57 41 52 4e 49 4e 47 2c 20 43 72 65 61 74 65 44 6f 73 50 61 74 68 52 65 73 6f 6c 76 65 54 68 72 65 61 64 28 29 20 66 61 69 6c 65 64 } //1 WARNING, CreateDosPathResolveThread() failed
		$a_00_11 = {46 69 6c 65 49 6e 66 6f 72 6d 61 74 69 6f 6e 43 6c 61 73 73 20 21 3d 20 46 69 6c 65 42 6f 74 68 44 69 72 65 63 74 6f 72 79 49 6e 66 6f 72 6d 61 74 69 6f 6e } //1 FileInformationClass != FileBothDirectoryInformation
		$a_00_12 = {4e 74 44 65 6c 65 74 65 46 69 6c 65 20 5b 70 72 6f 74 65 63 74 65 64 5d 3a } //1 NtDeleteFile [protected]:
		$a_00_13 = {4e 74 51 75 65 72 79 41 74 74 72 69 62 75 74 65 73 46 69 6c 65 20 5b 70 72 6f 74 65 63 74 65 64 5d 3a } //1 NtQueryAttributesFile [protected]:
		$a_00_14 = {4e 74 51 75 65 72 79 46 75 6c 6c 41 74 74 72 69 62 75 74 65 73 46 69 6c 65 20 5b 70 72 6f 74 65 63 74 65 64 5d 3a } //1 NtQueryFullAttributesFile [protected]:
	condition:
		((#a_02_0  & 1)*4+(#a_02_1  & 1)*4+(#a_02_2  & 1)*4+(#a_00_3  & 1)*1+(#a_00_4  & 1)*1+(#a_00_5  & 1)*1+(#a_00_6  & 1)*1+(#a_00_7  & 1)*1+(#a_00_8  & 1)*1+(#a_00_9  & 1)*1+(#a_00_10  & 1)*1+(#a_00_11  & 1)*1+(#a_00_12  & 1)*1+(#a_00_13  & 1)*1+(#a_00_14  & 1)*1) >=16
 
}