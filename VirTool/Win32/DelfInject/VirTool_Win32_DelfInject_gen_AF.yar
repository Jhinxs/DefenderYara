
rule VirTool_Win32_DelfInject_gen_AF{
	meta:
		description = "VirTool:Win32/DelfInject.gen!AF,SIGNATURE_TYPE_PEHSTR_EXT,0f 00 0f 00 1b 00 00 "
		
	strings :
		$a_01_0 = {73 00 79 00 73 00 6b 00 65 00 79 00 2e 00 65 00 78 00 65 00 00 00 00 00 10 00 00 00 61 00 6e 00 73 00 69 00 2e 00 73 00 79 00 73 00 00 00 } //3
		$a_00_1 = {43 3a 5c 50 72 6f 67 72 61 6d 20 46 69 6c 65 73 5c 50 61 72 61 6c 6c 65 6c 73 5c 50 61 72 61 6c 6c 65 6c 73 20 54 6f 6f 6c 73 00 } //3
		$a_00_2 = {53 62 69 65 44 6c 6c 2e 64 6c 6c } //2 SbieDll.dll
		$a_01_3 = {53 69 7a 65 6f 66 52 65 73 6f 75 72 63 65 } //1 SizeofResource
		$a_01_4 = {4c 6f 63 6b 52 65 73 6f 75 72 63 65 } //1 LockResource
		$a_00_5 = {4c 6f 61 64 52 65 73 6f 75 72 63 65 } //1 LoadResource
		$a_00_6 = {46 69 6e 64 52 65 73 6f 75 72 63 65 41 } //1 FindResourceA
		$a_01_7 = {46 72 65 65 52 65 73 6f 75 72 63 65 } //1 FreeResource
		$a_00_8 = {53 45 54 00 ff ff ff ff 02 00 00 00 43 46 00 } //5
		$a_01_9 = {89 45 ec c7 45 f4 01 00 00 00 8b 45 fc 8b 55 f4 8a 44 10 ff } //3
		$a_00_10 = {64 ff 35 00 00 00 00 64 89 25 00 00 00 00 bb 00 00 00 00 b8 01 00 00 00 0f 3f 07 0b 36 8b 04 24 64 89 05 00 00 00 00 83 c4 08 85 db 0f 94 c0 36 8d 65 fc 36 8b 1c 24 36 8b 6c 24 04 83 c4 08 c3 8b 4c 24 0c c7 81 a4 00 00 00 ff ff ff ff 83 81 } //5
		$a_01_11 = {0f 01 4d fa 81 7d fc 00 00 00 f0 7e 0b 81 7d fc 00 00 00 ff 7f 11 eb 15 81 7d fc 00 00 00 d0 7e 0c c6 45 f9 01 eb 0a c6 45 f9 02 eb 04 c6 45 f9 00 } //5
		$a_03_12 = {3c ff 74 04 3c e8 75 0b 90 09 0c 00 0f 01 0d ?? ?? ?? ?? a0 } //5
		$a_01_13 = {81 e2 ff 00 00 00 8a 54 10 01 32 16 81 e2 ff 00 00 00 88 11 41 46 ff 4d fc 75 } //5
		$a_01_14 = {02 14 18 81 e2 ff 00 00 00 8a 14 10 32 16 88 11 41 46 ff 4d fc 75 } //5
		$a_02_15 = {8b 45 fc 8a 44 38 ff 88 45 fb 8d 45 f4 8a 55 fb 4a e8 ?? ?? ?? ?? 8b 55 f4 8b c6 e8 ?? ?? ?? ?? 47 4b 75 dc } //5
		$a_03_16 = {e4 bb 01 00 00 00 8b 45 f8 0f b6 44 18 ff 99 f7 fb 33 f2 43 ff 4d ?? 75 ed 81 fe ff 00 00 00 7e } //5
		$a_01_17 = {32 c1 8b 4d f8 8b 7d e4 0f b6 4c 39 ff 03 c9 c1 e9 02 32 c1 32 d0 88 55 ef } //5
		$a_03_18 = {8b 00 ff d0 85 c0 74 28 8d 45 e4 50 8b 44 fe 24 e8 ?? ?? ?? ?? 50 8b 44 fe 08 50 8b 44 fe 0c 03 45 f0 50 8b 45 c8 50 a1 ?? ?? ?? ?? 8b 00 ff d0 43 ff 4d d8 75 a5 } //5
		$a_03_19 = {6a 00 6a 00 6a 04 6a 00 6a 00 6a 00 8b 45 ?? e8 ?? ?? ?? ?? 50 8b 45 ?? e8 ?? ?? ?? ?? 50 a1 ?? ?? ?? ?? 8b 00 ff d0 } //7
		$a_01_20 = {0f 01 4d fa 8a 45 ff 2c e8 74 04 2c 17 75 04 b0 01 eb 02 33 c0 } //5
		$a_03_21 = {0f 01 4d fa 90 05 04 01 90 8a 45 ff 3c ff 75 ?? [0-10] 3c e8 75 } //5
		$a_03_22 = {6a 00 6a 00 6a 00 68 (ff ff ff 0f|e0 ee ee ee) e8 ?? ?? ?? ?? 85 c0 (|) 74 75 } //5
		$a_03_23 = {3c 01 74 24 80 3d ?? ?? ?? ?? ff 74 1b 80 3d ?? ?? ?? ?? e8 74 12 e8 ?? ?? ?? ?? 3c 01 74 09 } //5
		$a_03_24 = {8b d8 68 f4 01 00 00 e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 2b c3 3d f4 01 00 00 73 } //5
		$a_03_25 = {32 44 11 01 25 ff 00 00 00 89 45 ?? 8b 45 ?? 8b 55 ?? 8a 4d ?? 88 0c 10 ff 45 ?? ff 4d ?? 0f 85 } //5
		$a_01_26 = {53 6f 66 74 70 6c 61 6e 5c 43 6f 6d 70 6f 6e 65 6e 74 65 73 5c 4d 52 55 } //-15 Softplan\Componentes\MRU
	condition:
		((#a_01_0  & 1)*3+(#a_00_1  & 1)*3+(#a_00_2  & 1)*2+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_00_5  & 1)*1+(#a_00_6  & 1)*1+(#a_01_7  & 1)*1+(#a_00_8  & 1)*5+(#a_01_9  & 1)*3+(#a_00_10  & 1)*5+(#a_01_11  & 1)*5+(#a_03_12  & 1)*5+(#a_01_13  & 1)*5+(#a_01_14  & 1)*5+(#a_02_15  & 1)*5+(#a_03_16  & 1)*5+(#a_01_17  & 1)*5+(#a_03_18  & 1)*5+(#a_03_19  & 1)*7+(#a_01_20  & 1)*5+(#a_03_21  & 1)*5+(#a_03_22  & 1)*5+(#a_03_23  & 1)*5+(#a_03_24  & 1)*5+(#a_03_25  & 1)*5+(#a_01_26  & 1)*-15) >=15
 
}